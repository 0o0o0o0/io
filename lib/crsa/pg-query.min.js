function getElementPgId(t){return t.attr("data-pg-id")}function getElementPgNode(t){var e=getElementPgId(t);return e?pgParserNodeCatalogueInstance.get(e):null}function pgRemovePgIdsFromCode(t){return t.replace(/(<[^>]*?)(\s*data\-pg\-id="[0-9]*")/g,"$1")}function pgCompareNodes(t,e){return t.toStringOriginal(!0)!=e.toStringOriginal(!0)?!1:!0}function pgFindChangedNodes(t,e,i){if(pgCompareNodes(t,e))return null;for(var r=[],n=[],s=0;s<t.children.length;s++)t.children[s].textNode&&t.children[s].content.match(pgWhiteSpaceRegExp)||r.push(t.children[s]);for(var s=0;s<e.children.length;s++)e.children[s].textNode&&e.children[s].content.match(pgWhiteSpaceRegExp)||n.push(e.children[s]);if(r.length!=n.length)return i.push({original:t,changed:e}),!0;for(var l=!1,s=0;s<r.length;s++)pgFindChangedNodes(r[s],n[s],i)&&(l=!0);return l&&t.tagName==e.tagName&&t.closingTag==e.closingTag&&t.content==e.content&&t.getAttributesString(pgGetAttributesStringFilterOutPgIds)==e.getAttributesString(pgGetAttributesStringFilterOutPgIds)?!0:(i.push({original:t,changed:e}),!0)}function pgFindChangedNodesInPage(t,e){var i,r,n=new CrsaProfile(!0),s=new pgParser;"string"==typeof t?(s.parse(t),i=s.rootNode):i=t,"string"==typeof e?(s.parse(e),r=s.rootNode):r=e,n.show("Find nodes parse");var l=[];if(pgFindChangedNodes(i,r,l),l.length)for(var o=0;o<l.length;o++)a=l[o],a.original.isElement&&a.changed.isElement||!a.original.parent||!a.changed.parent||(a.original=a.original.parent,a.changed=a.changed.parent);n.show("Find nodes");for(var h=[],o=0;o<l.length;o++){for(var a=l[o],g=!1,p=!1,u=0;u<h.length;u++)if(a.original==h[u].original){p=!0;break}if(!p){for(var d=0;d<l.length;d++)if(a.original.isDescendantOf(l[d].original)){g=!0;break}g||h.push(a)}}l=h;for(var o=0;o<l.length;o++)var a=l[o];return l}function pgNodeContainsDynamic(t){var e=getElementPgNode(t);if(!e)return!0;var i=!1;return t.find("*").each(function(t,e){return getElementPgId($(e))?void 0:(i=!0,!1)}),i}function pgFindDynamicDiffs(t,e){var i=e.get(0).outerHTML;i=removeCrsaClassesFromHtml(i);var r=new pgParser;r.assignIds=!1;var n={};t.walkSelfAndChildren(function(t){var e=t.getId();return e&&(n[e]=t),!0});var s=!1;return r.parse(i),r.rootNode.walk(function(t){if(t.dynamic=!1,t.dynamic_attributes=[],t.dynamic_content=!1,t.shouldHaveId()){var e=t.getId();if(e&&n[e]){var i=n[e].html(),r=t.html();i!=r&&(t.dynamic_content=!0,s=!0)}else t.dynamic=!0,s=!0}return!0}),s?r:null}function pgDescribeDynamicDiffs(t){var e=t.rootNode.toString(null,!0,!1,function(t,e,i){return"node"==i?e=t.dynamic?'_###span class="dynamic"###_'+e+"_###/span###_":'_###span class="static"###_'+e+"_###/span###_":"content"==i&&t.dynamic_content&&(e='_###span class="dynamic_content"###_'+e+"_###/span###_"),e});return e=pinegrow.formatHtml(e),e=escapeHtmlCode(e).replace(/_###/g,"<").replace(/###_/g,">")}function pgInsertNodeAtDOMElementLocation(t,e){var i=e.parent(),r=getElementPgNode(i);if(!r)return!1;var n=e.prev();if(0==n.length)r.prepend(t);else{var s=getElementPgNode(n);if(!s)return!1;t.insertAfter(s)}return!0}var pgNodeDomElementPair=function(t){t&&t.length&&(this.el=t.get(0),this.pgel=t?getElementPgNode(t):null),this.equal=function(t){return this.el==t}},pgQuery=function(t){var e=this;"array"==typeof t?this.list=t:t?t instanceof pgNodeDomElementPair?this.list=[t]:(this.list=[],t.each(function(t,i){e.add(new pgNodeDomElementPair($(i)))})):this.list=[],this.length=this.list.length};pgQuery.prototype.create=function(t){var e=pgCreateNodeFromHtml(t),i=$(e.toStringWithIds());return this.add(new pgNodeDomElementPair(i)),this},pgQuery.prototype.add=function(t){return this.list.push(t),this.length=this.list.length,this},pgQuery.prototype.get=function(t){return t>=this.list.length?null:this.list[t]},pgQuery.prototype.each=function(t){for(var e=0;e<this.list.length&&t(e,this.list[e])!==!1;e++);return this},pgQuery.prototype.indexOfElement=function(t){for(var e=0;e<this.list.length;e++)if(this.list[e].el==t)return e;return-1},pgQuery.prototype.find=function(t){var e=new pgQuery;return this.each(function(i,r){$(r.el).find(t).each(function(t,i){e.indexOfElement(i)<0&&e.add(new pgNodeDomElementPair($(i)))})}),e},pgQuery.prototype.is=function(t){return this.length>0&&$(this.get(0)).is(t)},pgQuery.prototype.closest=function(t){var e=new pgQuery;return this.each(function(i,r){$(r.el).closest(t).each(function(t,i){e.indexOfElement(i)<0&&e.add(new pgNodeDomElementPair($(i)))})}),e},pgQuery.prototype.parent=function(){var t=new pgQuery;return this.each(function(e,i){$(i.el).parent().each(function(e,i){t.indexOfElement(i)<0&&t.add(new pgNodeDomElementPair($(i)))})}),t},pgQuery.prototype.requireNode=function(t){if(!t.pgel)throw new pgParserException("DOM Element has no PG node",t.el)},pgQuery.prototype.attr=function(t,e){for(var i=0;i<this.list.length;i++){if("undefined"==typeof e)return this.requireNode(this.list[i]),this.list[i].pgel.getAttr(t);this.requireNode(this.list[i]),this.list[i].pgel.setAttr(t,e),this.list[i].el.setAttribute(t,e)}return"undefined"==typeof e?null:this},pgQuery.prototype.removeAttr=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.removeAttr(t),this.list[e].el.removeAttribute(t);return this},pgQuery.prototype.val=function(t){for(var e=0;e<this.list.length;e++){if("undefined"==typeof t)return $(this.list[e].el).val();$(this.list[e].el).val(t)}return this},pgQuery.prototype.html=function(t){for(var e=0;e<this.list.length;e++){if("undefined"==typeof t)return this.list[e].pgel.html();this.requireNode(this.list[e]),this.list[e].pgel.html(t),$(this.list[e].el).html(this.list[e].pgel.html(null,!0))}return this},pgQuery.prototype.text=function(t){for(var e=0;e<this.list.length;e++){if("undefined"==typeof t)return this.list[e].pgel.text();this.list[e].pgel.html(t),$(this.list[e].el).text(this.list[e].pgel.toStringWithIds())}return this},pgQuery.prototype.append=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var i=0;i<t.length;i++)this.requireNode(t.list[i]),this.list[e].pgel.append(t.list[i].pgel),$(this.list[e].el).append(t.list[i].el)}return this},pgQuery.prototype.prepend=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var i=0;i<t.length;i++)this.requireNode(t.list[i]),this.list[e].pgel.prepend(t.list[i].pgel),$(this.list[e].el).prepend(t.list[i].el)}return this},pgQuery.prototype.insertBefore=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var i=0;i<t.length;i++)this.requireNode(t.list[i]),this.list[e].pgel.insertBefore(t.list[i].pgel),$(this.list[e].el).insertBefore(t.list[i].el)}return this},pgQuery.prototype.insertAfter=function(t){for(var e=0;e<this.list.length;e++){this.requireNode(this.list[e]);for(var i=0;i<t.length;i++)this.requireNode(t.list[i]),this.list[e].pgel.insertAfter(t.list[i].pgel),$(this.list[e].el).insertAfter(t.list[i].el)}return this},pgQuery.prototype.hasClass=function(t){for(var e=0;e<this.list.length;e++)return this.requireNode(this.list[e]),this.list[e].pgel.hasClass(t);return!1},pgQuery.prototype.addClass=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.addClass(t),$(this.list[e].el).addClass(t);return this},pgQuery.prototype.removeClass=function(t){for(var e=0;e<this.list.length;e++)this.requireNode(this.list[e]),this.list[e].pgel.removeClass(t),$(this.list[e].el).removeClass(t);return this},pgQuery.prototype.replaceTag=function(t){for(var e=new pgQuery,i=0;i<this.list.length;i++){this.requireNode(this.list[i]),this.list[i].pgel.replaceTag(t);var r=$(this.list[i].el),n={};$.each(this.list[i].el.attributes,function(t,e){n[e.nodeName]=e.nodeValue});var s;r.replaceWith(function(){return s=$("<"+t+"/>",n).append(r.contents())}),e.add(new pgNodeDomElementPair(s))}return e},pgQuery.prototype.replaceWith=function(t,e){t instanceof pgQuery&&(t=t.get(0));for(var i=0;i<this.list.length;i++)return this.requireNode(this.list[i]),this.list[i].pgel.replaceWith(t.pgel,e),$(this.list[i].el).replaceWith(t.el),this;return this},pgQuery.prototype.remove=function(){for(var t=0;t<this.list.length;t++)this.requireNode(this.list[t]),this.list[t].pgel.remove(),$(this.list[t].el).remove();return this},pgQuery.prototype.detach=function(){for(var t=0;t<this.list.length;t++)this.requireNode(this.list[t]),this.list[t].pgel.detach(),$(this.list[t].el).detach();return this},pgQuery.prototype.contents=function(){for(var t=new pgQuery,e=0;e<this.list.length;e++){var i=this.list[e];$(i.el).children().each(function(e,i){t.indexOfElement(i)<0&&t.add(new pgNodeDomElementPair($(i)))})}return t};