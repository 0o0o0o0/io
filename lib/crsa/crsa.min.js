function escapeRegExp(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtmlCode(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function removeCrsaClasses(e){var t=e.attr("class");t&&(t=t.replace(/(^|\W)crsa\-[a-z\-]*/gi,""),e.attr("class",t))}function copyCodeToClipboard(e){if(isApp()){e=removeCrsaClassesFromHtml(e),e=pinegrow.formatHtml(e);var t=require("nw.gui"),a=t.Clipboard.get();a.set(e,"text"),crsaQuickMessage("Code copied to clipboard.")}}function removeCrsaClassesFromHtml(e){var t=/crsa\-[a-z\-]*/g;return e.replace(/class=".*"/g,function(e){return e.replace(t,"")}).replace(/(<[^>]*?)\s*class\=['"]\s*['"]/gi,"$1")}function makeDialog(e,t,a,n){"undefined"==typeof n&&(n="");var r="string"==typeof n?n:"",o='<div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                    <h4 class="modal-title">'+e+'</h4>                </div>                <div class="modal-body">'+r+'                </div>                <div class="modal-footer"><p class="pull-left"></p>';t&&(o+='<button type="button" class="btn btn-default btn-sm cancel">'+t+"</button>"),a&&(o+='<button type="button" class="btn btn-primary btn-sm ok">'+a+"</button>"),o+="</div>            </div>";var i=$("<div/>",{"class":"modal-dialog crsa-dialog-nonmodal"}).html(o);return"object"==typeof n&&i.find(".modal-body").append(n),i}function makeAndShowDialog(e,t,a,n,r,o){var i=makeDialog(e,t,a,n);$("body").append(i);var l=100,s=100;i.css("top",s+"px").css("left",l+"px"),i.draggable({handle:".modal-header"}).on("dragstart",function(){$.fn.crsapages("showOverlays")}).on("dragstop",function(){$.fn.crsapages("showOverlays",!0)}),i.find("button.close,button.cancel").click(function(){r&&r(),i.remove()}),i.find("button.ok").click(function(){o&&o(),i.remove()}),i.on("hidden.bs.modal",function(){i.remove()})}function setDialogNotice(e,t,a){var n=e.find(".modal-footer > p");n.html(t).attr("class","pull-left "+a)}function makeModalDialog(e,t,a,n,r,o,i){"function"==typeof n&&(n=n());var l=makeDialog(e,t,a,n);l.removeClass("crsa-dialog-nonmodal");var s=$("<div/>",{"class":"modal fade",tabIndex:"-1",role:"dialog"}).append(l);return s.find("button.close,button.cancel").click(function(){r&&r(),s.modal("hide")}),s.find("button.ok").click(function(){o&&o(),s.modal("hide")}),s.on("hidden.bs.modal",function(){s.remove()}),i&&i(s),s.modal({backdrop:!0}),s}function makeModalDialogWhole(e){"function"==typeof e&&(e=e());var t=$(e),a=$("<div/>",{"class":"modal fade",tabIndex:"-1",role:"dialog"}).append(t);return a.modal({backdrop:"static",keyboard:!1}),a}function showAlert(e,t,a,n,r,o){return t||(t="Notice"),n||a||(n="OK"),makeModalDialog(t,a,n,e,r,o)}function crsaHandleExternalLinks(e){isApp()&&e.find("a.external").on("click",function(e){e.preventDefault();var t=require("nw.gui"),a=$(e.delegateTarget).attr("href");t.Shell.openExternal(a)})}function showNotice(e,t,a,n,r,o){var a="notice_hide_"+a;if(!o){if(a in localStorage&&"1"==localStorage[a])return n&&n(),void 0;if(r&&a in localStorage)return n&&n(),void 0}var i=$('<label class="pull-left control-label"><input type="checkbox"> Don\'t show this notice again</label>'),l=showAlert(e,t,null,null,null,function(){n&&n(),localStorage[a]=i.find("input").is(":checked")?"1":"0"});return r||l.find(".modal-footer").prepend(i),crsaHandleExternalLinks(l),l}function showPrompt(e,t,a,n,r,o){var i=$('<form role="form">        <div class="form-group">        <label for="dlgInput">'+e+'</label>        <input type="text" class="form-control" id="dlgInput" placeholder="'+n+'">        </div>        </form>'),l=i.find("input"),s=i;s.on("submit",function(e){e.preventDefault(),o&&o(l.val()),c.modal("hide")}),a&&l.val(a);var c=showAlert(i,t,"Cancel","Ok",r,function(){o&&o(l.val())});return c.on("shown.bs.modal",function(){l.focus()}),c}function getIframeBody(e){var t=e.contentDocument||e.contentWindow.document;return t.body}function getIframeDocument(e){return e.contentDocument||e.contentWindow.document}function getIframeOfElement(e){var t=null;if(!e||0==e.length)return null;var a=e.get(0).ownerDocument;return $("iframe.content-iframe").each(function(e,n){var r=getIframeDocument(n);return r==a?(t=$(n),!1):void 0}),t}function getElementPgId(e){return e.attr("data-pg-id")}function getElementPgNode(e,t){var a=getElementPgId(e);return a&&(t||(t=getCrsaPageOfElement(e)),t&&t.sourceNode)?t.sourceNode.getByPgId(a):null}function getCrsaPageOfElement(e){var t=getIframeOfElement(e);return t?getCrsaPageForIframe(t):null}function shortenString(e,t,a){return"undefined"==typeof a&&(a="..."),!e||e.length<=t?e:e.substr(0,t)+a}function getObjectFromElement(e){return e&&e.length>0?{type:"element",data:e}:null}function getObjectFromRule(e){return{type:"rule",selector:e.selector,data:e}}function getUniqueId(e,t,a){var n=0;"undefined"!=typeof a&&(a=""+a,n=parseInt(a.replace(/[a-z]*/i,""))),t||(t=pinegrow.getSelectedPage());var r=t?t.get$Html():null;e||(e="crsa_id_");for(var o=a?n:gen_id_count;;){o++;var i=e+o;if(r){if(0==r.find("#"+i).length)return a||(gen_id_count=o),i}else if(0==$("#"+i).length)return a||(gen_id_count=o),i}}function getClosestCrsaElement(e){for(var t=getType(e);e&&e.length>0&&null===t;)e=e.parent(),t=getType(e);return t?e:$()}function getType(e,t,a,n){"undefined"==typeof t&&(t=!1);var r=null;if(!t){if(r=e.data("crsa-def"))return r;if(r===!1)return null}return a?null:(n||(n=getCrsaPageForIframe(getIframeOfElement(e))),n?($.each(n.getComponentTypes(),function(t,a){var n=!1;return"function"==typeof a.selector?n=a.selector(e):a.selector&&(n=e.is(a.selector)),n?(r=a,!1):!0}),r&&e.data("crsa-def",null!==r?r:!1),r):(console.log("El has no page "+e.get(0)),null))}function getElementName(e,t,a,n,r,o){var i=e.get(0);if(!e||!i)return t?t.name:"Element";if(t||(t=getType(e)),!t)return i.tagName+" (unknown)";var l=null;if(t.display_name&&"function"==typeof t.display_name)l=t.display_name(e,t);else{var s;r&&(s=e.text().substring(0,30),s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),l=t.name;var c=i.nodeName.toLowerCase();o||"tag"==t.display_name?l=c:o&&l.toLowerCase()!=c&&(l+=" ("+c+")");var d=i.id;if(d&&(l+=a?'<span class="name-id">#'+d+"</span>":"#"+d),n){var u=i.className;u&&(u=u.replace(/\s*crsa\-[a-z\-]*/gi,""),u=u.replace(/\s\s+/g,"").replace(/\s/gi,"."),u&&u.length>0&&(l+=a?'<span class="name-class">.'+u+"</span>":"."+u))}s&&(l=l+" | "+(a?'<span class="name-text">'+s+"</span>":s))}return l}function isInDOMTree(e){return!!findUltimateAncestor(e).body}function findUltimateAncestor(e){for(var t=e;t.parentNode;)t=t.parentNode;return t}function getTreeNodeForElement(e){var t=e.data("crsa-tree-node");return t&&t.length>0&&isInDOMTree(t.get(0))?t:null}function isApp(){return"undefined"!=typeof process&&process.versions&&"node-webkit"in process.versions}function crsaChooseFile(e,t,a,n){var r=$('<input style="display:none;" type="file"/>').appendTo($("body"));a&&r.attr("multiple",""),n&&r.attr("nwworkingdir",n),t?r.attr("nwsaveas",t):r.removeAttr("nwsaveas"),r.on("change",function(){var t=$(this).val(),n=a?t:crsaMakeUrlFromFile(t);t&&t.length>0&&e(n,t),r.remove()}),r.trigger("click")}function crsaGetObjectParentUrl(e){if("element"==e.type){var t=e.data;return getCrsaPageForIframe(getIframeOfElement(t)).url}return"rule"==e.type?e.data.crsa_stylesheet.url:"stylesheet"==e.type?e.data.url:null}function crsaGetVersion(){return"1.15"}function crsaCheckForNewVersion(e){$.ajax({url:"http://pinegrow.com/version.json?z="+(new Date).getTime(),data:null,dataType:"json"}).done(function(t){t.version&&parseFloat(t.version)>parseFloat(crsaGetVersion())?e(t):e(null)}).fail(function(){e(null)})}function crsaGetVersionName(){var e=crsaGetVersion()+" "+(isApp()?"App":"Web");return isApp()&&crsaIsBig()&&(e+=" Pro"),e}function crsaIsBig(){return crsaStorage.getValue("crsaBig")?!0:isApp()?0:1}function crsaCheckMe(e,t,a){for(var n="",r=0;r<e.length;r++){var o=e.charCodeAt(r);if(n+=String.fromCharCode(o*(r+11)%25+65),4==r)break}return a&&console.log(n),t.toLowerCase()==n.toLowerCase()}function crsaIsEmailActivated(){if(isApp()&&crsaIsBig())return!0;if(!crsaStorage.getValue("userEmail"))return!1;if(!crsaStorage.getValue("activationCode"))return!1;var e=crsaCheckMe(crsaStorage.getValue("userEmail"),crsaStorage.getValue("activationCode"));return e&&!crsaStorage.getValue("activatedDate")&&crsaStorage.setValue("activatedDate",(new Date).getTime()),e}function crsaGenCode(e,t){t||(t=0);var a=8,n=65,r=90,o=3,i=0,l="";if(e){if(e=$.trim(e.toUpperCase()),e.length!=a)return!1;for(var s=0;a>s;s++){var c=e.charCodeAt(s);if(s%o!=o-1);else if(c!=i%(r-n)+n)return!1;i+=c}return!0}for(var s=0;a>s;s++){var c;c=s%o!=o-1?Math.round(Math.random()*(r-n))+n:i%(r-n+t)+n,l+=String.fromCharCode(c),i+=c}return l}var gen_id_count=1;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame,function(e){function t(t){var a=null,n=0,r=0,o=X.crsapages("getZoom");X.find(".content").each(function(o,i){var l=e(i),s=l.offset(),c=l.width(),d=l.height();return t.pageX>=s.left&&t.pageX<=s.left+c&&t.pageY>=s.top&&t.pageY<=s.top+d?(a=l.find("> iframe"),n=t.pageX-s.left,r=t.pageY-s.top,!1):void 0});var i=getType(nt);if(at=!1,a){var l=a,s=getIframeDocument(l[0]),d=e(getIframeBody(l.get(0)));n/=o,r/=o;var u=e(s.elementFromPoint(n,r));if(u.length>0&&u.get(0)===nt.get(0))return;for(u.has(d.get(0)).length>0&&(u=d);u.length>0&&nt.has(u.get(0)).length>0&&!u.is("body");)u=u.parent();if(nt.has(u.get(0)).length>0)return;{var p,f=u,g=null,m=!1;u.closest(".crsa-selected")}i.parent_selector&&(u=u.closest(i.parent_selector),m=!0);for(var h="img,iframe,script,embed,vide,audio,:hidden",v=function(e){return"inline"==e.css("display")&&!e.is("img")};!u.is("body")&&(u.is(h)||(v(u)||u.is("p"))&&!v(nt));)u=u.parent(),m=!0;if(m?u.length>0?(p=C(u),f=getClosestCrsaElement(f),p.children().each(function(t,a){return e(a).find(f).length>0||a==f.get(0)?(g=e(a),!1):void 0})):at=!0:(u=getClosestCrsaElement(u),u.length>0&&(p=C(u))),0==u.length||!p||0==p.length)return!0;var w=u.offset(),b=n-w.left,y=r-w.top;if(!et||et[0]!==u[0]){if(et=u,tt={inline:!0,appended:null,iframe:l},et&&(nt.find(et).length>0||et.get(0)===nt.get(0)))return;var k=nt.attr("style");nt.hide();var T=u.width(),S=u.height();nt.show(),k?nt.attr("style",k):nt.removeAttr("style");var P=u.width(),A=u.height();tt.inline=P-T>A-S,c(u)}var E=getCrsaPageForIframe(l);if(E.undoSetFlag||(E.undoSetFlag=!0,E.undoStack.add("Drag & Drop / "+getElementName(nt))),g){var D=g.offset(),I=n-D.left;I<g.width()/2?nt.insertBefore(g):nt.insertAfter(g)}else{var T=u.width(),S=u.height(),_=tt.inline?b>T/2:y>S/2;tt.appended!==_&&(_?p.append(nt):p.prepend(nt),tt.appended=_)}nt.get(0).ownerDocument!=s&&console.log("different iframe!"),c(u)}else et=null,nt&&nt.detach()}function a(t){if(!t.preview)return r(t);if("none"==t.preview)return null;var a="function"==typeof t.preview?t.preview(o()):t.preview,n=e("<div/>").append(a).contents();return n.data("crsa-def",t),n.get(0).crsaDef=t,n}function n(e){return"function"==typeof e.code?e.code(o()):e.code}function r(t){var a=n(t),r=e("<div/>").append(a).contents(),o=e(r.get(0));if(o.data("crsa-def",t),o.get(0).crsaDef=t,t&&t.empty_placeholder){var i="string"==typeof t.empty_placeholder?t.empty_placeholder:"pg-empty-placeholder",l=0==o.get(0).innerHTML.length||""==e.trim(o.html());l?o.hasClass(i)||o.addClass(i):o.removeClass(i)}return r}function o(){return{body:K?getIframeBody(K.get(0)):null,page:K}}function i(t,a){if("element"==t.type){var n=t.data,r=n.data("crsa-values");if(r)return r;var o=e("iframe.content-iframe");r={};var i=l(t);!a&&i&&(a=i.sections?i.sections:null);{n.attr("id")}return i&&a&&e.each(a,function(a,i){i.fields&&e.each(i.fields,function(a,i){var l=i.action?i.action:"style";if(i.get_value)r[a]=i.get_value(t,a);else if("none"==l);else if("style"==l){if(!c){var s=n.attr("id");if(s)var c=o.crsacss("find","#"+s)}if(c&&c.length>0){var d=o.crsacss("getCss",c,a);d&&("image"==i.type&&(d=d.replace(/url\(/g,"").replace(/\"/g,"").replace(/\'/g,"").replace(/\)/g,"")),r[a]=d)}}else if("apply_class"==l){var u=xt(i,t);u?(r[a]="__EMPTY__",e.each(u,function(e,t){return n.hasClass(t.key)?(r[a]=t.key,!1):void 0})):i.value&&(r[a]=n.hasClass(i.value)?i.value:null)}else if("element_id"==l)r[a]=n.attr("id");else if("element_attribute"==l)r[a]=n.attr(i.attribute);else if("element_html"==l)r[a]=n.html();else if("rules"==l)if(kt.showOnlyClassesInProperties){var p=[];e.each(n.get(0).classList,function(e,t){p.push("."+t)}),r[a]=p}else r[a]=K.crsacss("getRulesForElement",n,!0)})}),r}if("rule"==t.type){r={};var i=l(t),s=t.data,c=s.values;return i&&i.sections&&e.each(i.sections,function(a,n){e.each(n.fields,function(e,a){var n=a.action?a.action:"style";if(a.get_value)r[e]=a.get_value(t,e);else if("style"==n&&c){var o,i=c[e]?c[e]:null;i&&(o=i.value,"image"==a.type&&(o=o.replace(/url\(/g,"").replace(/\"/g,"").replace(/\'/g,"").replace(/\)/g,"")),r[e]=i.value)}else"rule_name"==n?r[e]=t.selector:"rule_media"==n&&(r[e]=s.media?s.media:null)})}),r}return{}}function l(t,a){switch(t.type){case"element":return getType(t.data,a);case"rule":return e.fn.crsa.defaults.rulesDefinition}return null}function s(e,t,a,n,r){r||(r=t.position());var o=a,i=o.left*n+r.left,l=o.top*n+r.top-t.contents().scrollTop()*n;e.css("left",i+"px").css("top",l+"px")}function c(t){if(yt){var a=getIframeOfElement(yt);a&&a.parent().find(".crsa-hl-overlay").hide()}var n=e.fn.crsapages("getZoom"),r=function(t){var a=o.find(t);return a&&0!=a.length||(a=e("<div/>",{"class":"crsa-hl-overlay "+t.replace(/\./g," ")}).appendTo(o)),a};if(t&&t.length>0){var a=getIframeOfElement(t);if(!a)return;var o=a.parent(),i=a.position();yt=t,t.each(function(t,l){if(1==t)return!1;var c=e(l),d=c.offset(),u=parseInt(c.css("padding-left")),p=u*n,f=parseInt(c.css("padding-right")),g=f*n,m=parseInt(c.css("padding-top")),h=m*n,v=parseInt(c.css("padding-bottom")),w=v*n,b=parseInt(c.css("margin-top")),y=b*n,k=parseInt(c.css("margin-bottom")),C=k*n,T=parseInt(c.css("margin-left")),S=T*n,P=parseInt(c.css("margin-right")),A=P*n,E=c.innerWidth()-u-f,D=E*n,I=c.innerHeight()-m-v,_=I*n,F=rt&&"element"==rt.type&&rt.data.get(0)==c.get(0),M=r(".crsa-hl-size");M.css({width:D+p+g+"px",height:_+h+w+"px"}),s(M,a,{left:d.left,top:d.top},n,i),M.appendTo(o),F&&M.hide();var x=r(".crsa-hl-padding-top");x.css({width:D+p+g+"px",height:h+"px"}),s(x,a,{left:d.left,top:d.top},n,i),x.appendTo(o);var x=r(".crsa-hl-padding-bottom");x.css({width:D+p+g+"px",height:w+"px"}),s(x,a,{left:d.left,top:d.top+m+I},n,i),x.appendTo(o);var x=r(".crsa-hl-padding-left");x.css({width:p+"px",height:_+"px"}),s(x,a,{left:d.left,top:d.top+m},n,i),x.appendTo(o);var x=r(".crsa-hl-padding-right");x.css({width:g+"px",height:_+"px"}),s(x,a,{left:d.left+u+E,top:d.top+m},n,i),x.appendTo(o);var x=r(".crsa-hl-margin-top");x.css({width:D+p+g+"px",height:y+"px"}),s(x,a,{left:d.left,top:d.top-b},n,i),x.appendTo(o);var x=r(".crsa-hl-margin-bottom");x.css({width:D+p+g+"px",height:C+"px"}),s(x,a,{left:d.left,top:d.top+m+I+v},n,i),x.appendTo(o);var x=r(".crsa-hl-margin-left");x.css({width:S+"px",height:h+_+w+"px"}),s(x,a,{left:d.left-T,top:d.top},n,i),x.appendTo(o);var x=r(".crsa-hl-margin-right");x.css({width:A+"px",height:h+_+w+"px"}),s(x,a,{left:d.left+u+E+f,top:d.top},n,i),x.appendTo(o);var O=d.top-b-16/n,x=r(".crsa-hl-name");x.html(getElementName(c,null,!1,!0,!1,!0)),O<a.scrollTop()+20?(O=d.top+m+I+v,d.left=d.left+u+E+f-x.outerWidth()/n):F&&(O=d.top+m+I+v),s(x,a,{left:d.left,top:O},n,i),x.appendTo(o)}),o.find("> .crsa-hl-overlay").show()}else yt=null}function d(a){var n=new CrsaProfile,o=rt?rt.data:null,i=a?getIframeOfElement(a):o?getIframeOfElement(o):null;if(i){o&&o.removeClass("crsa-selected"),e(getIframeBody(i.get(0))).find(".crsa-selected").removeClass("crsa-selected");var s=getTreeRootForElement(a,i),c=getCrsaPageForIframe(i);(null==c.treeCurrentRoot||null==s||s.get(0)!=c.treeCurrentRoot.get(0))&&Et.createTreeWidget(i,e("#crsa-tree"),s),(null==K||K.get(0)!=i.get(0))&&Dt(i);var p=null,f=!1;if(a){var p=getTreeNodeForElement(a);if(p&&p.data("crsa-element").get(0)==a.get(0)){for(var m=p.parent().closest("ul.crsa-tree-node-closed");m.length>0;)p=m.closest("li"),m=p.parent().closest("ul.crsa-tree-node-closed");a=p.data("crsa-element"),f=p.find(">ul.crsa-tree-node-closed").length>0}a&&a.addClass("crsa-selected"),o=a}else o=null;a&&(o=a,U.setSelectedElement(a,lt)),J&&(J.remove(),J=null);var y=null;if(o){rt=getObjectFromElement(o),y=l(rt,!0);var k=i.closest(".page"),C=e("<div/>",{"class":"crsa-inline-menu"}).appendTo(e(k)),T=e("<i/>",{"class":"fa fa-fw fa-trash-o crsa-inline-menu-delete"}).appendTo(C);T.on("click",function(e){var t=getClosestCrsaElement(o.parent());willMakeChange(K,"Delete element / "+getElementName(o)),h(o,i,function(){didMakeChange(K,t),$t(o,Q)}),e.preventDefault()});var S=e("<i/>",{"class":"fa fa-fw fa-copy crsa-inline-menu-duplicate"}).appendTo(C);S.on("click",function(e){willMakeChange(K,"Duplicate element / "+getElementName(o)),w(o,i,function(e){didMakeChange(K,e,e.parent()),Nt(e),Et.updateStructureAndWireAllElemets(i,e.parent()),P(i)}),e.preventDefault()});var A=[{label:"Edit content",action:function(t){H.startEdit(e(".crsa-edit-toolbar"),t)}},{label:"Remove tags",action:function(e){willMakeChange(K,"Remove tags / "+getElementName(e)),b(e,i),didMakeChange(K,e)}},{label:"Edit code","class":"action-edit-code",kbd:"C",action:function(e){v(e)}},{label:Et.isCollapsed(o)?"Uncollapse":"Collapse",action:function(e){Et.collapseElement(e,null)}},{label:"Add as Component","class":"action-add-comp",kbd:"O",action:function(e){g(e)}},{label:"Insert Lorem Ipsum",action:function(e){willMakeChange(K,"Insert Lorem Ipsum to / "+getElementName(e));var t="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus pulvinar faucibus neque, nec rhoncus nunc ultrices sit amet. Curabitur ac sagittis neque, vel egestas est. Aenean elementum, erat at aliquet hendrerit, elit nisl posuere tortor, id suscipit diam dui sed nisi. Morbi sollicitudin massa vel tortor consequat, eget semper nisl fringilla. Maecenas at hendrerit odio. Sed in mi eu quam suscipit bibendum quis at orci. Pellentesque fermentum nisl purus, et iaculis lectus pharetra sit amet.",a=(e.html(),e.get(0).tagName.toLowerCase());["h1","h2","h3","h4","h5","h6"].indexOf(a)>=0&&(t="Lorem ipsum dolor sit amet"),r(y).html()==e.html()?e.html(""):e.html().length>0&&(t=" "+t),e.append(t),didMakeChange(K,e)}}];if(isApp()&&A.push({label:"Copy code","class":"action-copy-code",action:function(e){copyCodeToClipboard(e.get(0).outerHTML)}}),y){var E={add:y.action_menu&&y.action_menu.add?y.action_menu.add:null,on_add:y.action_menu&&y.action_menu.on_add?y.action_menu&&y.action_menu.on_add:null,actions:y.action_menu&&y.action_menu.actions?A.concat(y.action_menu.actions):A};if(E){var D=e("<div/>",{"class":"btn-group"}).html('<button type="button" class="btn btn-link btn-xs dropdown-toggle" data-toggle="dropdown">Actions <span class="caret"></span></button>                    <ul class="dropdown-menu" role="menu">                    </ul>').appendTo(C),I=D.find("ul");E.add&&(e("<li/>",{"class":"dropdown-header",role:"presentation"}).html("Insert").appendTo(I),e.each(E.add,function(t,a){var n=Q.getTypeDefinition(a);if(n){e("<li/>",{"class":"add"}).html('<a href="#">'+n.name+"</a>").appendTo(I).data("add-def",n)}})),E.actions&&(e("<li/>",{"class":"dropdown-header",role:"presentation"}).html("Actions").appendTo(I),e.each(E.actions,function(t,a){var n=e("<li/>",{"class":"action"}).html('<a href="#" class="'+(a.class?a.class:"")+'">'+a.label+"</a>").appendTo(I).data("action",a);a.kbd&&crsaAddKbd(n.find(">a"),a.kbd)})),I.find("a").on("click",function(t){t.preventDefault();var a=e(t.delegateTarget).closest("li");if(a.hasClass("add")){var n=a.data("add-def");It(E,o,n,!1)}else if(a.hasClass("action")){var r=a.data("action");willMakeChange(K,"Action - "+r.label),r.action(o),didMakeChange(K,o)}}),D.find(".btn").button()}}f&&C.addClass("collapsed");var _=null,F=e("<i/>",{"class":"fa fa-bars crsa-inline-menu-move"}).appendTo(C);o&&o.is("body")&&F.hide();var M=!1,x=null;crsaIsInEdit()?F.on("mousedown",function(e){crsaIsInEdit()&&(showAlert("Go out of content editing mode before moving elements.","Can't move during content editing"),e.preventDefault(),e.stopImmediatePropagation())}):F.draggable({helper:function(){var t=o.clone(!0).css("opacity",.5).css("min-width",400).css("min-height",200).css("transform","scale(0.33, 0.33)").css("transform-origin","0 0");return e("body").append(t),t.get(0)}}).on("dragstart",function(t){e.fn.crsapages("clearUndoSetFlag"),_=getIframeOfElement(o),nt=o.clone(!0,!0).removeClass("crsa-selected").removeClass("crsa-highlighted"),willMakeChange(_,"Drag & Drop / "+getElementName(o)),getCrsaPageForIframe(_).undoSetFlag=!0,t.shiftKey?M=!0:(M=!1,x=o.attr("style"),o.hide()),C.hide(),X.crsapages("showOverlays")}).on("dragstop",function(t,a){X.crsapages("showOverlays",!0);var n=getIframeOfElement(nt),r=!1;a.helper.remove(),et||(M=!1,r=!0,showAlert("Move elements only <b>within the page</b> or <b>from page to page</b>. If you want to use the tree, move tree elements withing the tree.","Invalid drop target")),M||(o.show(),x?o.attr("style",x):o.removeAttr("style")),r||(_.get(0)!=n.get(0)?(Et.updateStructureAndWireAllElemets(_),Dt(n),didMakeChange(_)):M||o.remove(),et&&(Et.updateStructureAndWireAllElemets(n),didMakeChange(n,nt,nt.parent()),jt(nt,getCrsaPageForIframe(_),getCrsaPageForIframe(n)))),et=null,d(nt),e.fn.crsapages("clearUndoSetFlag"),nt=null}).on("drag",function(e){t(e)}),u(C,o,i),J=C;var O;J.on("mousewheel",function(){var e=J.get(0);e.classList.contains("crsa-disable-hover")||e.classList.add("crsa-disable-hover"),O=setTimeout(function(){e.classList.remove("crsa-disable-hover")},250)}),n.show("se 2")}else rt=null;Et.showSelectedInsertFactory(o),Et.showProperties(rt,null,y),e("body").trigger("crsa-element-selected",rt),K&&o&&getCrsaPageForIframe(K).elementWasSelected(o)}}function u(e,t,a){var n=X.crsapages("getZoom"),r=a.position(),o=a.parent().position();r.left+=o.left,r.top+=o.top;var i=t.offset(),l=i.left*n+r.left,s=i.top*n+r.top-a.contents().scrollTop()*n,c=e.outerHeight(),d=e.outerWidth();return s-=c,20>s&&(s=(i.top+t.outerHeight())*n+r.top-a.contents().scrollTop()*n,s>100?s=100:20>s&&(s=-100)),l+d>a.width()*n-100&&e.find(".dropdown-menu").addClass("pull-right"),l+d>a.width()*n&&(l=a.width()*n-d),e.css("left",l+"px").css("top",s+"px"),void 0;var c,s}function p(){J&&rt&&"element"==rt.type&&u(J,rt.data,K)}function f(t,a,n){n||(n=Q.getAllTypes(a));var r=null;return e.each(n,function(e,a){return a.action_menu&&a.action_menu.add&&a.action_menu.add.indexOf(t.type)>=0?(r=a.action_menu,!1):void 0}),r}function g(t,a){a||e.each(Q.frameworks,function(e,t){return t.user_lib?(a=t,!1):void 0});var n;a||(a=new PgFramework("userlib"+Math.floor(1e5*Math.random()),"User Lib"),a.user_lib=!0,pinegrow.addFramework(a),Q.addFramework(a)),a.lib_sections.length>0?n=a.lib_sections[0]:(n=new PgFrameworkLibSection(a.key+"_components","Components"),a.addLibSection(n));var r=a.getAutoId("comp"),o=new PgComponentType(r.type,"Comp "+r.count);m(t,o,Q,!0),a.addComponentType(o),n.addComponentType(o),a.changed=!0,pinegrow.frameworksChanged(),crsaQuickMessage("Component was added to LIB.")}function m(t,a,n,r){var o=n.getAllTypes(t);a.code=t.get(0).outerHTML,a.parent_selector=null,a.preview=null;var i=!r;e.each(o,function(e,t){return t.name&&!i&&(i=!0,a.name+=" / "+t.name),t.parent_selector?(a.parent_selector=t.parent_selector,!1):void 0})}function h(t,a,n){var r=(new Date).getTime(),o=(e("#crsa-tree > div.tree-container"),t.parent());t.remove(),d(null),Et.updateStructureAndWireAllElemets(a,o),c(null),n&&n();var i=(new Date).getTime()-r;console.log("Delete element "+i+" ms")}function v(t){if(t.is("script")||t.find("script").length>0)return showAlert("<p>Editing code blocks <strong>with scripts</strong> is not supported.</p><p>Use page code view instead (Page -&gt; Edit code).</p>","Can't edit code here"),void 0;if(t.is("body"))return showAlert("<p>Use page code view to edit code of the <b>body</b> element (<b>Page -&gt; Edit code</b> or <b>CMD + E</b>).</p>","Can't edit code here"),void 0;willMakeChange(K,"Edit element code / "+getElementName(t));var a=e("body"),n=makeDialog("Edit element","Cancel","Keep changes [Esc]","<div></div>").css("width","50%").addClass("crsa-dialog-edit");a.append(n),n.on("keydown",function(e){27==e.which&&(n.find("button.ok").trigger("click"),e.preventDefault())});var r=n.find(".modal-body>div").css("height","200px"),o=ace.edit(r.get(0));o.setTheme("ace/theme/"+pinegrow.getSetting("code-theme","xcode")),o.getSession().setUseWrapMode(!0),o.getSession().setMode("ace/mode/html"),o.getSession().setUseWorker(!1),o.focus();var i=t.get(0),l=t.attr("id"),s=(l?l:getUniqueId(),!1),c=function(a){a=e.trim(a);var r=e(getIframeDocument(K.get(0)).createElement("div")).append(a).contents();return s=t.is("script")||t.find("script").length>0?!0:!1,1==r.length?(t.replaceWith(r),rt&&"element"==rt.type&&rt.data.get(0)==t.get(0)&&(rt=getObjectFromElement(r)),t=r,setDialogNotice(n,""),!0):(-1==r.length?setDialogNotice(n,"You can only edit one HTML element here!","text-danger"):setDialogNotice(n,"Oops... your HTML has problems! Only one element, pls!","text-danger"),!1)},d=i.outerHTML,u=removeCrsaClassesFromHtml(d);u=html_beautify(u),o.setValue(u,-1),o.getSession().getSelection().clearSelection();e(getIframeBody(K.get(0)));o.getSession().on("change",function(){c(o.getValue())&&(Et.setNeedsUpdateDelayed(t),didMakeChange(K))});var p=function(){crsaQuickMessage("Refresh page (Page -&gt; Refresh Page) to activate script changes.",2e3)};n.find("button.close,button.cancel").click(function(){c(d),n.hide(),n.remove(),Et.setNeedsUpdate(!0,t),getCrsaPageForIframe(K).undoStack.remove(),didMakeChange(K),s&&p()}),n.find("button.ok").click(function(){n.hide(),n.remove(),Et.setNeedsUpdate(!0,t),s&&p()});var f=a.width()-n.width()-100,g=a.height()-n.height()-100;n.css("top",g+"px").css("left",f+"px"),n.draggable({handle:".modal-header"}).on("dragstart",function(){e.fn.crsapages("showOverlays")}).on("dragstop",function(){e.fn.crsapages("showOverlays",!0)})}function w(e,t,a){var n=e.clone();removeCrsaClasses(n);var r=e.css("opacity"),o=n.attr("style");n.css("opacity","0"),null==r&&(r=1),n.insertAfter(e),Et.isCollapsed(e)&&n.data("crsa-tree-collapsed",n.children().length>0),n.animate({opacity:r},100,function(){o?n.attr("style",o):n.removeAttr("style"),a&&a(n)})}function b(e,t){e.replaceWith(e.contents()),Et.updateStructureAndWireAllElemets(t),P(t)}function y(e,t,a,n,r,o){return"element"==e.type?getElementName(e.data,t,a,n,r,o):"rule"==e.type?getRuleName(e.data):void 0}function k(t,a){var n;if(n=kt.showOnlyClassesInProperties?e.fn.crsacss("getClassesForElement",a):e.fn.crsacss("getRulesForElement",a,!0,!0)){var r=e("<ul/>",{"class":"clearfix"}).appendTo(t);e.each(n,function(t,a){if("object"==typeof a&&(a=a.selector?a.selector:null),a){var n=null!=getClassFromSelector(a),o=e("<li/>",{"class":"crsa-input-rule"+(n?" class":"")}).appendTo(r).data("class",a).html(a);if(n){e("<i/>",{"class":"fa fa-times crsa-input-rule-remove"}).appendTo(o)}}})}var o=e("<li/>",{"class":"link crsa-input-add-class"}).appendTo(r).html('<a href="#">+ Add class</a>');o.find("a").on("click",function(t){t.preventDefault(),s(e(t.delegateTarget))});{var i=function(){var t=e("#crsa-rules");pt.setReferenceElement(a,!0),pt.setShowOnlyClasses(!1,!0),pt.setFilter(null),pt.showListPanel(!1),0==l.find("#crsa-rules").length&&l.append(t),e("#crsa-rules-out").data("panel").show()};e("<a/>",{"class":"cm-prop-addrule",href:"#"}).html("CSS Rules...").appendTo(t).on("click",function(e){i(),e.preventDefault()})}t.find(".crsa-input-rule-remove").on("click",function(t){var a=e(t.delegateTarget),n=a.parent(),r=n.data("class");e("#crsa-rules").trigger("crsa-cm-class-remove",r),t.preventDefault(),t.stopPropagation()});var l=e("#crsa-rules-out .panel-content"),a=rt.data;t.find(".crsa-input-rule").on("click",function(t){var n=e(t.delegateTarget),r=n.data("class"),o=e("#crsa-rules");pt.setReferenceElement(a,!0),pt.setShowOnlyClasses(!1,!0),pt.setFilter(r),pt.filter_set_in_props_mode=!0,pt.showListPanel(!1),0==l.find("#crsa-rules").length&&l.append(o),e("#crsa-rules-out").data("panel").show(),t.preventDefault()});var s=function(t){var a=t.offset(),n=a.left>e(window).width()/2?"left":"right",r=getUniqueId();if(t.data("popover-active"))return t.popover("destroy"),t.data("popover-active",null),void 0;{var o=function(e){setTimeout(function(){e.closest(".popover").remove()},500)};t.popover({html:!0,placement:n,trigger:"manual",title:"Assign CSS class",container:"body",content:'<form id="'+r+'"><div class="form-group"><input class="form-control" placeholder="class-name" style="margin-bottom:8px;"/><p class="help-block"></p></p><button class="ok assign btn">Assign</button><button class="ok show-css btn btn-link">Show list...</button><button class="closeit btn btn-link">Cancel</button></div></form>'}).on("shown.bs.popover",function(){var a=e("#"+r),n=a.find("input").focus(),l=a,s=a.find("button.assign"),c=a.find("button.show-css"),d=(a.find("p.help-block").hide(),a.find("button.closeit")),u=function(){var r=e.trim(n.val());return r&&0!=r.length?(r=r.replace(".",""),e("#crsa-rules").trigger("crsa-cm-class-add",r),t.popover("hide"),o(a),void 0):(a.addClass("has-error"),void 0)};l.on("submit",function(e){e.preventDefault(),u(e)}),s.on("click",function(e){e.preventDefault(),u(e)}),c.on("click",function(e){e.preventDefault(),i(),t.popover("hide"),o(a)}),d.on("click",function(e){t.popover("hide"),e.preventDefault(),o(a)})}).on("hidden.bs.popover",function(){setTimeout(function(){t.popover("destroy").data("popover-active",null)},10)})}t.popover("show").data("popover-active",!0)}}function C(e){var t=getType(e,!1);return t.inner_container?e.find(t.inner_container):e}function T(e){window.console&&window.console.log&&window.console.log("CRSA - "+e)}function S(t){var a=e("#crsa-left-plane .nav-tabs");switch(t){case"lib":a.find("li:eq(0) a").tab("show");break;case"prop":a.find("li:eq(1) a").tab("show");break;case"css":a.find("li:eq(2) a").tab("show");break;case"vars":a.find("li:eq(3) a").tab("show")}}function P(e){e||(e=K)}function A(){var t=e(window),a=t.width(),n=t.height(),r=X.offset(),o=n-r.top;X.css("height",o+"px");var i=e("#crsa-left-plane"),l=e("#crsa-tree"),s=e("#textedit"),c=e("#textedit_bar"),d=s.is(":visible");if(d){i.hide(),l.hide();var u=s.offset(),p=n-u.top,f=a/2;f>800&&(f=800),s.css("height",p+"px").css("width",f+"px"),c.show();{c.offset()}c.css("width",f+"px"),X.crsapages("centerPages",f+10,10)}else i.show(),l.show(),c.hide(),X.crsapages("centerPages",i.offset().left+i.width()+10,a-l.offset().left+10);var g=i.offset(),m=n-g.top;i.css("height",m+"px");var h=e("#crsa-rules-out");h.data("panel").autoSize();var v=i.find(".tab-content"),w=v.position(),b=m-w.top;v.css("height",b+"px");var y=l.offset(),k=n-y.top;l.css("height",k+"px"),e.fn.crsapages("canvasResized")}function E(){D(),alert("Saving files is disabled in trial version. Use Page -> Edit code to see or copy the code.")}function D(){if(Tt){var t=require("fs"),a=Pt+"/datapg.comm";try{t.unlinkSync(a)}catch(n){}console.log("__PG_UPGRADE__"),At&&clearInterval(At),At=setInterval(function(){try{var n=t.readFileSync(a,{encoding:"utf8"});n&&"108"==n&&(crsaStorage.setValue("crsaBig","true"),e("#crsa-topbar .trial").hide(),alert("Thanks for upgrading the app!")),t.unlinkSync(a)}catch(r){console.log("waiting for "+a)}},1e3)}else R();return}function I(){var t='<p><a target="_blank" class="link" href="http://pinegrow.com">Pinegrow Web Designer</a> &copy; Humane technologies llc.</p> <p>Designed &amp; developed by <a href="mailto:matjaz@humane-tehnologije.si">Matjaz Trontelj</a>.</p> <p>Pinegrow uses the following open source projects:</p> <ul> <li><a target="_blank" class="link" href="https://github.com/rogerwang/node-webkit">Node-Webkit</a> (Node.js + Chromium)</li> <li><a target="_blank" class="link" href="https://github.com/mjsarfatti/nestedSortable">nestedSortable</a> for jQuery UI</li> <li><a target="_blank" class="link" href="http://bgrins.github.io/spectrum/">Spectrum</a> color picker</li> <li><a target="_blank" class="link" href="http://ace.c9.io/">Ace editor</a></li> <li><a target="_blank" class="link" href="http://fontawesome.io/">Font Awesome</a></li> <li><a target="_blank" class="link" href="http://getbootstrap.com/">Twitter Bootstrap</a></li> <li><a target="_blank" class="link" href="http://jquery.com">jQuery and jQuery UI</a></li> <li><a target="_blank" class="link" href="http://lesscss.org/">Less.js</a></li> <li><a target="_blank" class="link" href="https://github.com/Stuk/jszip">jsZip</a></li> </ul>',a=makeModalDialog("About Pinegrow Web Designer - "+crsaGetVersionName(),"Close",null,t);
isApp()&&a.find("a.link").on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)})}function _(){var t='<p>Feel free to contact us at <a href="mailto:info@pinegrow.com">info@pinegrow.com</a>.</p>        <p>When reporting a bug please include screenshots and sample files/code that will help us to investigate the problem.</p>        <p>And check out <a class="link" target="_blank" href="http://pinegrow.com/index.html#support">Support section</a> of our website.</p>',a=makeModalDialog("Contact us","Close",null,t);isApp()&&a.find("a.link").on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)})}function F(t,a){var n='<p>Download Pinegrow desktop app for Windows and Mac to <b>open and save your local files directly</b>.</p><p><a href="http://pinegrow.com" target="_blank">Download Pinegrow for Mac, Windows and Linux</a></p>';t&&(n=t+n);var r=makeModalDialog("Download Pinegrow Web Designer"+(a?" "+a:""),"Close",null,n);isApp()&&r.find("a.link").on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)})}function M(){return!0}function x(t){var a,n=null;!function(r){e(t.get(0).contentWindow).off("scroll.crsa").on("scroll.crsa",function(){if(t.get(0)==K.get(0)&&(p(),J)){var e=J.get(0);clearTimeout(a),e.classList.contains("crsa-disable-hover")||e.classList.add("crsa-disable-hover"),a=setTimeout(function(){e.classList.remove("crsa-disable-hover")},250)}n&&0!=n.length||(n=r.$page.find(".crsa-hl-name")),n.is(":visible")&&c(null)}).off("click.crsa").on("click.crsa",function(t){"HTML"==t.target.tagName&&(t.preventDefault(),e(r.getBody()).trigger("click"))}),e(r.getDocument()).off("keydown.crsa").on("keydown.crsa",function(e){return Et.processKeydownEvent(e)}),t.get(0).contentWindow.ondragover=function(e){return e.preventDefault(),!1},t.get(0).contentWindow.ondrop=function(e){return e.preventDefault(),!1}}(getCrsaPageForIframe(t))}function O(){if(crsaStorage.getValue("activatedDate")){var e=7,t=86400,a=parseInt(crsaStorage.getValue("activatedDate")),n=Math.floor(((new Date).getTime()-a)/1e3);crsaStorage.hasValue("trialVersion")&&crsaStorage.getValue("trialVersion")!=crsaGetVersion()&&n>1*t&&(a=(new Date).getTime()-0*e*t*1e3,n=Math.floor(((new Date).getTime()-a)/1e3),crsaStorage.setValue("activatedDate",a),crsaStorage.setValue("trialVersion",crsaGetVersion));var r=e*t;return n>r?0:r-n}return null}function N(){var e=O();if(null===e)return"not started yet";if(0===e)return"expired";var t=Math.round(e/86400);return t>0?1==t?"1 day left":t+" days left":"less than 1 day left"}function $(e){pinegrow.getComponent("whatsnew",function(t){var a=t.html;showNotice(a,"Welcome to Pinegrow "+crsaGetVersion(),"new_version_"+crsaGetVersion(),null,!0,e)})}function j(){pinegrow.getComponent("settings",function(e){var t=e.html,a=showAlert(t,"Pinegrow Settings","Cancel","Save",function(){L(c)},function(){pinegrow.setSetting("backup",n.is(":checked")?"1":"0"),pinegrow.setSetting("show-placeholders",o.is(":checked")?"1":"0"),pinegrow.setSetting("code-theme",i.val()),pinegrow.setSetting("html-indent-size",l.val()),pinegrow.setSetting("ui-zoom",s.val())}),n=a.find(".backup"),r=pinegrow.getSetting("backup","1");"1"==r&&n.attr("checked","checked");var o=a.find(".show-placeholders");r=pinegrow.getSetting("show-placeholders","1"),"1"==r&&o.attr("checked","checked");var i=a.find(".code-theme");r=pinegrow.getSetting("code-theme","xcode"),i.val(r);var l=a.find(".html-indent-size");r=pinegrow.getSetting("html-indent-size","4"),l.val(r);var s=a.find(".ui-zoom");r=pinegrow.getSetting("ui-zoom","0"),s.val(r);var c=r;s.on("change",function(){L(s.val())})})}function L(e){if(isApp()){e=parseFloat(e);{var t=require("nw.gui");t.Window.get().zoomLevel=e}}}function R(){pinegrow.getComponent("dialog-intro",function(t){var a=t.html,n=e(".intro");0==n.length?(n=makeModalDialogWhole(a).addClass("intro"),n.on("hidden.bs.modal",function(){setTimeout(function(){n.remove()},500)})):n.modal("show");var r=n.find(".intro-section-trial-active"),o=n.find(".intro-section-3trial-active");o.find("p.why").hide(),o.find("h3 a").on("click",function(e){e.preventDefault(),o.find("p.why").toggle(),gaSendPageView("trialInfo")});var i=function(){var e=o.find(".trial-days-left");e.html(N())},l=n.find(".modal-header .close"),s=!0;n.find(".modal-footer .btn").on("click",function(e){e.preventDefault(),s?(n.modal("hide"),$()):null===O()?alert("Please activate the trial first. It'll only take a minute."):alert("Trial has expired. Get the full version to continue using Pinegrow.")});var c=n.find(".intro-section-trial1"),d=c.find("form"),u=c.find("#trialEmail"),p=n.find(".intro-section-trial2"),f=p.find("form"),g=p.find("#trialCode"),m=c.find(".btn-link"),h=p.find(".btn-link"),v=n.find(".intro-section-buy"),w=v.find("form"),b=w.find("#buyEmail"),y=w.find("#buySerial"),k=n.find(".intro-section-buy-done"),C=function(e,t,a){a||(a="has-error");var n=e.parent().find("p.text-danger");t?(e.find(".form-group").addClass(a),n.html(t).show(),e.find("button i").hide().parent().removeAttr("disabled")):(e.find(".form-group").removeClass("has-error has-success"),n.html("").hide(),e.find("button i").hide().parent().removeAttr("disabled"))},T=function(e){e?l.show():l.hide(),s=e};C(d),C(f),C(w),k.hide(),crsaStorage.getValue("userEmail")&&u.val(crsaStorage.getValue("userEmail")),T(!0),crsaIsBig()?(r.hide(),o.hide(),c.hide(),p.hide(),v.hide(),k.show()):crsaIsEmailActivated()?(i(),M()?(o.show(),r.hide()):(r.show(),o.hide()),c.hide(),p.hide(),0===O()&&T(!1)):(T(!1),r.hide(),o.hide(),p.hide(),m.on("click",function(t){t.preventDefault();var a=e.trim(u.val());a&&a.indexOf("@")>=0?(crsaStorage.setValue("userEmail",a),c.hide(),p.show()):C(d,"Please enter your email address. Enter the same email you used to get the activation key.")}),h.on("click",function(e){e.preventDefault(),p.hide(),c.show()}));var S='Email could not be registered. Please check if your email and key are correct. <a href="mailto:info@pinegrow.com">Contact us</a> if the problem persists, we\'ll help you out.';d.on("submit",function(t){C(d,null),t.preventDefault();var a=e.trim(u.val());if(gaSendPageView("RegisterEmail/Step1"),!a||a.indexOf("@")<0)C(d,"Please enter your email address.");else{var n=d.find("button i");n.show(),n.parent().attr("disabled","disabled");var r=require("request"),o={email:a,aaashort:!0};r({uri:"http://shop.pinegrow.com/cob/callSmarty/Course/externalActivateEmail",method:"POST",form:o},function(e,t,n){if(e)C(d,S+" ("+e+")");else try{var r=JSON.parse(n);r&&"OK"==r.status?(crsaStorage.setValue("userEmail",a),C(d,null),c.hide(),p.show(),alert("The activation key was send to your email address. Please check your inbox and your spam folder. Enter the key under 1. START TRIAL.")):C(d,S)}catch(o){C(d,S)}})}});var P='Invalid activation code. Please check if your email and activation code are correct. <a href="mailto:info@pinegrow.com">Contact us</a> if the problem persists, we\'ll help you out.';f.on("submit",function(t){C(f,null),t.preventDefault();var a=e.trim(g.val()),n=crsaStorage.getValue("userEmail")?crsaStorage.getValue("userEmail"):"unknown";a?crsaCheckMe(n,a)?(crsaStorage.setValue("activationCode",a),crsaStorage.setValue("activatedDate",(new Date).getTime()),crsaStorage.setValue("trialVersion",crsaGetVersion()),i(),C(f,"Activated! Thanks.","has-success"),gaSendPageView("RegisterEmail/Activated"),o.show(),p.hide(),T(!0),alert("Your 7 day trial was activated. Use Page -> Edit Code to check out the code. Upgrade the app to save files directly.")):C(f,P):C(f,"Please enter the activation code.")});var A='Pinegrow could not be upgraded. Please check if your email and serial number are correct. <a href="mailto:info@pinegrow.com">Contact us</a> if the problem persists, we\'ll help you out.',E=function(){crsaStorage.setValue("crsaBig",!0),e("ul.trial li").hide(),gaSendPageView("BuyScreen/AppActivated"),C(w),v.hide(),k.show(),c.hide(),p.hide(),r.hide(),o.hide(),T(!0)};w.find("button").on("click",function(e){if(e.shiftKey){e.preventDefault();var t=crsaStorage.getValue("manualToken");t||(t="MC"+Math.ceil(1e4*Math.random()),crsaStorage.setValue("manualToken",t)),alert("Activation token is "+t)}}),w.on("submit",function(t){C(w),t.preventDefault();var a=e.trim(b.val()),n=e.trim(y.val());if(a&&n){var r=crsaStorage.getValue("manualToken");if(r&&crsaCheckMe(r,n,"matjaz@pllop.com"==a))E();else{var o=w.find("button i");o.show(),o.parent().attr("disabled","disabled");var i=require("request"),l={email:a,serial:n};i({uri:"http://shop.pinegrow.com/cob/callSmarty/Course/externalActivateProduct",method:"POST",form:l},function(e,t,a){if(e)C(w,A+" ("+e+")");else try{var n=JSON.parse(a);n&&"OK"==n.status?E():C(w,A)}catch(r){C(w,A)}})}}else C(w,"Please fill out both fields: email and serial number.")}),isApp()&&n.find("section a").on("click",function(t){var a=e(t.delegateTarget).attr("href");if(a){t.preventDefault();var n=require("nw.gui"),a=e(t.delegateTarget).attr("href");a.indexOf("paddle")>=0&&gaSendPageView("paddle"),n.Shell.openExternal(a)}})})}e.fn.crsa=function(t){return Et[t]?Et[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.crsa"),void 0):Et.init.apply(this,arguments)};var V,U,W,q,H=null,B=null,z=null,K=null,Q=null,G=!1,Y=null,Z=null,X=null,J=null,et=null,tt=null,at=!1,nt=null,rt=null,ot=null,it=null,lt=!1,st=null,ct=!1,dt="__EMPTY__",H=(new less.Parser,new CrsaEditor),ut=!0,pt=null,ft=!1,gt=null,mt=e("body"),ht=null,vt=[],wt=null,bt=null,yt=null,kt=null,Ct=null,Tt=!1,St=null,Pt=null,At=null,Et={init:function(t){if(isApp()){console.log("Running as standalone app...");var a=require("nw.gui");process.on("uncaughtException",function(e){console.log("node exception "+e)}),Pt=a.App.dataPath,e.each(a.App.argv,function(e,t){t.indexOf("--pg-home-dir")>=0&&(St=t.replace("--pg-home-dir=",""),Tt=!0,console.log("Nice, I'm a Mac App!"))})}else console.log("Running as web app...");navigator.platform.indexOf("Win")>=0&&(ct=!0),V=e.extend({},e.fn.crsa.defaults,t),kt=V.custom_logic?V.custom_logic:new PgCustomLogic,V.templates&&e.each(V.templates,function(e,t){var a=new CrsaProject;a.fromSimpleTemplate(t),vt.push(a)});var n=[];if(e.each(e.fn.crsa.defaults.types,function(e,t){n.push(t)}),n.sort(function(e,t){return e.priority==t.priority?0:e.priority<t.priority?-1:1}),e.fn.crsa.defaults.types={},e.each(n,function(t,a){e.fn.crsa.defaults.types[a.type]=a}),Lt(),$trial=e("#crsa-topbar .trial"),isApp()?crsaIsBig()&&$trial.hide():$trial.html('<li><span>You\'re playing in the online playground.</span> <a href="#">Download Mac / Windows app for more.</a></li>'),$trial.find("a").on("click",function(e){isApp()?R():F(),e.preventDefault()}),window.pinegrow=new Pinegrow,B=new CrsaCodeEdit,W=new Ft,isApp())try{q=new CrsaHttpServer,pinegrow.httpServer=q,console.log("Internal http server running on "+q.url)}catch(o){console.log("Could not start internal http server: "+o)}if(e("body").trigger("pinegrow-ready",pinegrow),isApp()&&pinegrow.loadAllFrameworksFromFile(),crsaAddKbd(e(".menu-file-save"),"CMD S"),crsaAddKbd(e(".menu-file-save-as"),"SHIFT CMD S"),ct||crsaAddKbd(e(".menu-file-save-all"),"ALT CMD S"),isApp()){e(".menu-project-divider").remove(),e(".menu-file-save-project").remove(),e(".menu-file-load-project").remove(),e(".menu-file-download").remove(),crsaIsBig()||e(".menu-dev-tools").remove();var i=function(){crsaCheckForNewVersion(function(t){if(t){var a=e(".version-info").html("");a.append("<h4>update is available for download</h4>"),a.append("<p>"+t.desc+"</p>"),a.append('<a href="'+t.url+'">Learn more &amp; download</a>'),a.find("a").on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)}),a=e("#crsa-topbar .trial li");var n=e('<a href="http://pinegrow.com" data-toggle="tooltip" data-placement="bottom" title="'+t.desc+'" target="_blank">Update is available for download</a>');a.html(""),a.append(n),a.parent().show(),n.tooltip(),n.on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)})}})};i(),setInterval(function(){i()},36e5);var a=require("nw.gui");a.Window.get().maximize();var l=a.Window.get();L(pinegrow.getSetting("ui-zoom","0")),l.on("close",function(){crsaHasChanges()?showAlert("One or more pages or component libraries (see File -> Manage Frameworks) have unsaved changes. Are you sure you want to quit the app?","Unsaved changes","Don't quit","Quit",null,function(){l.close(!0)}):l.close(!0)})}else e(".menu-file-save").remove(),e(".menu-file-save-html").remove(),e(".menu-file-save-as").remove(),e(".menu-file-save-all").remove(),e(".menu-file-cache").remove(),e(".menu-save-divider").remove(),e(".menu-file-new-window").remove(),e(".menu-dev-tools").remove(),window.onbeforeunload=function(){return crsaHasChanges()?"Some of the pages and stylesheets are changed. Changes will be lost if you leave this page.":null};pt=new CrsaClassManager(e("#crsa-rules")),X=this.find(".canvas"),ot=e("#crsa-rule-edit");var s=0;if(navigator.userAgent.match(/msie/i)?s=0:navigator.userAgent.match(/webkit/i)?s=2:navigator.userAgent.match(/mozilla/i)&&(s=1),0==s)alert("Sorry, Internet explorer is not supported at the moment. Pinegrow Web Designer works in Chrome, Safari and FireFox. Or you can download the Pinegrow desktop app for Windows.");else{pinegrow.sourceParser&&crsaQuickMessage("Source Parser ACTIVE!",4e3),ct&&e("body").addClass("win"),isApp()&&e("body").addClass("app"),e("body").crsastorage(),e("div.canvas").crsapages(),X.crsacss(),U=new CrsaTree(e("#crsa-tree")),U.onSortReceive=function(e,t,a,n){willMakeChange(K,"Added to tree / "+getElementName(e)),factoryCopyHelper=null,nt&&(nt.remove(),nt=null);var o=z.data("crsa-factory-def");if(!e){var i=o;i&&(o=i,e=r(i),e.data("crsa-def",null),i=getType(e),n.item.html("").append('<div class="crsa-tree-node-name">'+i.name+"</div>").data("crsa-element",e))}var l=C(t);if(1>a)l.prepend(e);else{var s=n.item.prev().data("crsa-element");e.insertAfter(s)}didMakeChange(K,e),Nt(e,o),d(e),window.requestAnimationFrame(function(){Et.updateStructureAndWireAllElemets(getIframeOfElement(e),e.parent())})},U.onSortStart=function(e){X.crsapages("showOverlays"),willMakeChange(K,"Tree Drag & Drop / "+getElementName(e))},U.onSortStop=function(e,t,a,n){if(!e){var o=z.data("crsa-factory-def");o&&(e=r(o))}var i=C(t);if(1>a)i.prepend(e);else{var l=n.item.prev().data("crsa-element");e.insertAfter(l)}X.crsapages("showOverlays",!0),didMakeChange(K,e),lt=!0,lt=!1};e.each(V.pages,function(e,t){Et.openPage(t.src)}),0==V.pages.length&&isApp()&&!crsaIsBig()?setTimeout(function(){R()},1e3):$();var u=function(e){var t=e,a=0,n=function(){var e=t[a],r=crsaMakeUrlFromFile(e);Et.openPage(r,null,function(r){r.localFile=e,scrollCanvasToPage(r.$iframe),a++,a<t.length&&n()})};t.length>0&&n()};if(isApp()){window.ondragover=function(e){return e.preventDefault(),!1},window.ondrop=function(e){return e.preventDefault(),!1};var p=e("body").get(0);p.ondragover=function(){return!1},p.ondragend=function(){return!1},p.ondrop=function(e){e.preventDefault();var t=[];if(e.dataTransfer.files){for(var a=0;a<e.dataTransfer.files.length;++a)t.push(e.dataTransfer.files[a].path);u(t)}return!1}}e(".menu-file-open-file").on("click",function(e){return e.preventDefault(),gaSendPageView("FileOpen"),isApp()?(crsaChooseFile(function(e,t){u(t.split(";"))},null,!0),void 0):(F('<div class="alert alert-info">Use <b>File - New page</b> to add a page to your project. Or download Pinegrow desktop app to open your local files.</div>',"to open your files"),void 0)}),e(".menu-file-open-url").on("click",function(e){if(e.preventDefault(),gaSendPageView("FileOpenUrl"),!isApp())return F('<div class="alert alert-info">Use <b>File - New page</b> to add a page to your project. Or download Pinegrow desktop app to open files from the Internet.</div>',"to open remote files"),void 0;var t=showPrompt("Page url:","Open page from url",null,"http://pinegrow.com",null,function(e){e&&(e.indexOf("://")<0&&(e="http://"+e),Et.openPage(e,null,function(e){scrollCanvasToPage(e.$iframe)}))});t.find(".modal-body").append("<p>NOTE: <b>If you want to save changes</b> it is recommended to first save the page locally (for example, with &quot;Save as complete page&quot; in your browser) and then open it with <b>Open file</b>.</p><p>Only stylesheets <b>hosted on the same domain</b> as the .HTML page can be edited.</p><p>Local (file://) stylesheets <b>can not be attached</b> to a remote page.</p>")});var f=function(){vt&&(wt=new CrsaProjectBrowser,wt.title="Add a page to your project",wt.intro="<p>Choose a page to add to your project:</p>",wt.setProjects(vt),wt.selectedProject=bt,wt.onFileSelected=function(e,t){Et.openPage(e.url,null,function(e){e.crsaProjectTemplate=t,scrollCanvasToPage(e.$iframe),bt=t})},wt.show())};e(".menu-file-template").on("click",function(e){e.preventDefault(),gaSendPageView("FileOpenTemplate"),isApp(),f()});var g=function(){"1"==pinegrow.getSetting("backup","1")&&showNotice("<p>When you save a file Pinegrow saves a <b>backup copy of the original file</b> into the _pgbackup folder, located in the same location as the saved file. A current timestamp is appended to the backup file name.</p><p>This feature is useful when you are still experimenting with Pinegrow and want to make sure that you don't accidentally corrupt your source files in case Pinegrow can't handle them correctly (like templates, PHP, JSP...). But this can create a lot of backup files.</p><p>You can <b>disable backups</b> in <b>Support -&gt; Settings</b>.</p>","About file backups","save-backup")};e(".menu-file-save").on("click",function(e){if(e.preventDefault(),K)if(isApp()){if(!crsaIsBig()&&ut)return E(),void 0;var t=getCrsaPageForIframe(K);t.live_update&&t.save_parent&&(t=t.live_update),t.save(function(e){},!0,!0),g()}else F('<div class="alert alert-info">Use <b>File - Download your project</b> to download a Zip file with your project.</div>',"to save files")}),e(".menu-file-save-as").on("click",function(e){if(e.preventDefault(),K){if(!crsaIsBig()&&ut)return E(),void 0;var t=getCrsaPageForIframe(K);t.save(function(e){e||console.log("File saved!")},!0,!0,!0),g()}}),e(".menu-file-save-html").on("click",function(e){if(e.preventDefault(),K){if(!crsaIsBig()&&ut)return E(),void 0;var t=getCrsaPageForIframe(K);t.live_update&&t.save_parent&&(t=t.live_update),t.save(function(e){e||console.log("File HTML saved!")},!0,!1),g()}}),e(".menu-file-save-all").on("click",function(t){if(t.preventDefault(),K){if(!crsaIsBig()&&ut)return E(),void 0;e.fn.crsapages("saveAll"),t.preventDefault(),g()}}),e(".menu-file-close-all").on("click",function(t){t.preventDefault();var a=function(){var t=e.fn.crsapages("getAllPages").slice();e.each(t,function(e,t){t.force_close=!0,t.$page.find(".crsa-close").trigger("click")})};if(crsaHasChanges()){var n=showAlert("One or more pages have unsaved changes. Do you want to save changes before closing?","Unsaved changes","Cancel","Save all &amp; Close",null,function(){return!crsaIsBig()&&ut?(setTimeout(function(){E()},1e3),void 0):(e.fn.crsapages("saveAll"),a(),g(),void 0)});e('<a href="#" class="btn pull-left">Don\'t save</a>').appendTo(n.find(".modal-footer")).on("click",function(e){e.preventDefault(),a(),n.modal("hide")})}else a();t.preventDefault()}),e(".menu-file-download").on("click",function(t){return t.preventDefault(),K?(gaSendPageView("FileDownload"),isApp()&&!crsaIsBig()&&ut?(D(),void 0):(e.fn.crsapages("downloadAllPages"),void 0)):void 0}),e(".menu-file-save-project").on("click",function(e){if(e.preventDefault(),K){gaSendPageView("FileSaveProject");var t=new CrsaBrowserStorage;t.hasSavedProject()||(isApp()?showAlert("<p>Your current project was saved. You can open it later with <b>File - Load project</b>.</p><p><b>Only one project can be saved in this way.</b> Use File - Open and File - Save to open and save any file you want.</p>"):showAlert('<p>Your current project was saved to browser storage. You can open it later with <b>File - Load project</b>.</p><p><b>Only one project can be saved in this way.</b> <a href="http://pinegrow.com#buy" target="_blank"><b>Get the Pinegrow desktop app</b></a> to open and save any file you want.</p>')),t.saveProject()?crsaQuickMessage("Project was saved."):showAlert("There is nothing to save. First add some pages to the project (<b>File - New page</b>).","Nothing to save")}}),e(".menu-file-load-project").on("click",function(e){e.preventDefault(),gaSendPageView("FileLoadProject");var t=new CrsaBrowserStorage;t.hasSavedProject()?t.restoreProject()||showAlert("Ups... something went wrong.","Couldn't load project"):showAlert("No saved project found. Choose <b>File - Remember project</b> to save a project first.","Couldn't load project")}),e(".menu-file-close").on("click",function(e){e.preventDefault(),Q&&Q.$page.find(".crsa-close").trigger("click")}),e(".menu-dev-tools").on("click",function(e){if(isApp()){var t=require("nw.gui").Window.get();t.showDevTools(),e.preventDefault()}}),e(".menu-file-cache").on("click",function(e){var t=require("nw.gui");t.App.clearCache(),e.preventDefault()}),e(".menu-file-manage-ss").on("click",function(t){e.fn.crsacss("showStylesheetsManager",null),t.preventDefault()}),e(".menu-file-manage-fm").on("click",function(t){e.fn.crsacss("showFrameworkManager"),t.preventDefault()}),e(".menu-file-new-window").on("click",function(e){if(e.preventDefault(),isApp()){a.Window.get(window.open(window.location.href))}}),e(".menu-support-about").on("click",function(e){I(),e.preventDefault()}),e(".menu-support-settings").on("click",function(e){j(),e.preventDefault()}),e(".menu-support-contact").on("click",function(e){_(),e.preventDefault()}),e(".menu-support-new").on("click",function(e){$(!0),e.preventDefault()}),e(".menu-support-tour").on("click",function(e){crsaPlayTour(),e.preventDefault()}),e(".menu-support-docs, .menu-support-portal").on("click",function(t){if(isApp()){var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n),t.preventDefault()}}),e(".menu-support-tutorial").on("click",function(e){e.preventDefault(),pinegrow.openPage("templates/learn/tutorial.html")});var m=e("#crsa-zoom"),h=function(){var t;t=e.fn.crsapages("getFit")?"Fit":Math.ceil(100*e.fn.crsapages("getZoom"))+"%",m.find("button").html(t+' <span class="caret"></span>')},v=function(t){"fit"==t?e("div.canvas").crsapages("setFit",!0):(t/=100,e("div.canvas").crsapages("setFit",!1),e("div.canvas").crsapages("zoom",t)),h()};kt&&kt.defaultZoom?v(kt.defaultZoom):v(1);for(var w=m.find("ul").html(""),b=100;b>0;b-=10){var y=b+"%";e("<li/>").html('<a href="#">'+y+"</a>").appendTo(w).data("zoom",b)}e("<li/>").html('<a href="#">Fit</a>').appendTo(w).data("zoom","fit"),m.find("a").on("click",function(t){t.preventDefault();var a=e(t.delegateTarget).closest("li").data("zoom");v(a)}),m.find(".btn").button(),e("#crsa-preview-switch").on("change",function(){ft=e("#crsa-preview-switch").prop("checked"),ft&&(d(null),c(null),crsaQuickMessage("You can also use SHIFT + CLICK to test clicks.",3e3))}),Et.showFactory(),Et.showProperties(null);var k=e("#crsa-rules"),T=function(e,t,a){t=t.replace(".","");var n=getElementName(e);if(Q.sourceNode){var r=getElementPgNode(e),o=new pgParserSourceProblem(r,e);if(r?a&&e.hasClass(t)&&(r.canRemoveClass(t)||o.add("class",t,"remove")):o.add("element",getElementName(e),"change"),!o.ok())return showAlert(o.toString(),"Can't edit this element"),d(e),void 0;a?r.removeClass(t):r.addClass(t)}a?(willMakeChange(K,n+" | Remove class "+t),e.removeClass(t)):(willMakeChange(K,n+" | Add class "+t),e.addClass(t)),crsaQuickMessage("Class <b>"+t+"</b> "+(a?"removed from":"assigned to")+" <b>"+n+"</b>."),d(e),didMakeChange(K,e)};k.on("crsa-cm-class-add",function(e,t){rt&&"element"==rt.type&&T(rt.data,t)}),k.on("crsa-cm-class-remove",function(e,t){rt&&"element"==rt.type&&T(rt.data,t,!0)}),k.on("crsa-cm-edit",function(e,t){var a=getObjectFromRule(t);Et.showProperties(a,ot)}),A(),e(window).on("resize",A),e('#crsa-left-plane a[href="#tab3"]').on("show.bs.tab",function(){var t=e("#crsa-rules"),a=e("#tab3");e("#crsa-rules-out").data("panel").hide(),0==a.find("#crsa-rules").length&&(pt.setReferenceElement(rt&&"element"==rt.type?rt.data:null,!0),pt.setShowOnlyClasses(!1,!0),pt.filter_set_in_props_mode&&pt.setFilter(null,!1),pt.refresh(),a.append(t))}),S(kt.openTab);var P=e("#crsa-left-plane"),M=P.find("i.hider").on("click",function(e){var t=P.width();P.hasClass("closed")?(P.removeClass("closed"),P.animate({left:0},150,function(){M.addClass("fa-angle-double-left").removeClass("fa-angle-double-right"),A()}),P.find(".tab-content").animate({opacity:1},150)):(P.addClass("closed"),P.animate({left:-t+25},150,function(){M.removeClass("fa-angle-double-left").addClass("fa-angle-double-right"),A()}),P.find(".tab-content").animate({opacity:0},150)),e.preventDefault()}),x=e("body");e(window).on("scroll",function(){0!=x.scrollTop()&&x.scrollTop(0)}),x.on("crsa-frameworks-changed",function(){Et.showProperties(rt,null)}),e("#crsa-fullscreen").on("click",function(e){e.preventDefault(),x.get(0).webkitRequestFullScreen()}),e("#crsa-undo").on("click",function(e){if(K){var t=getCrsaPageForIframe(K).undoStack;t.isAtTheTip()&&t.add("Undo",!0),t.undo(function(){didMakeChange(K),x.trigger("crsa-stylesheets-changed"),x.trigger("crsa-breakpoints-changed")})}e.preventDefault()}),e("#crsa-redo").on("click",function(e){K&&getCrsaPageForIframe(K).undoStack.redo(function(){didMakeChange(K),x.trigger("crsa-stylesheets-changed"),x.trigger("crsa-breakpoints-changed")}),e.preventDefault()}),X.on("crsa-page-closed",function(t,a){B.isInEdit(a.$iframe)&&B.exitEdit(!1),K&&K.get(0)==a.$iframe.get(0)&&(Dt(null),rt=null,Et.showSelectedInsertFactory(null),Et.showProperties(null)),U.closeTreeForPage(a),null==K&&setTimeout(function(){if(!K){var t=e.fn.crsapages("getAllPages");t.length>0&&Dt(t[0].$iframe)}},100)}),X.on("crsa-page-clone",function(e,t){Et.openPage(t.url,function(){},function(e){var a=Et.getSourceOfPage(t.$iframe);Et.setSourceOfPage(e.$iframe,a),scrollCanvasToPage(e.$iframe)},t.duplicate())}),X.on("crsa-page-mirror",function(e,t){Et.openPage(t.url,function(){},function(e){var a=Et.getSourceOfPage(t.$iframe);Et.setSourceOfPage(e.$iframe,a),scrollCanvasToPage(e.$iframe),e.setLiveUpdate(t),showNotice("Any changes done to the body of the original page will be <b>mirrored to the duplicated page</b>. And, any changes done to the duplicated page will be <b>mirrored back to the original page</b>.","Mirroring works both ways","mirror")},t.duplicate())}),X.on("crsa-page-view",function(e,t){var a=t.duplicate();a.deviceWidth=320,Et.openPage(t.url,function(){},function(e){e.save_parent=!0;var a=Et.getSourceOfPage(t.$iframe);Et.setSourceOfPage(e.$iframe,a),scrollCanvasToPage(e.$iframe),e.setLiveUpdate(t),showNotice("Changes will be mirrored between views. Original page will be saved when you save a view. Use &quot;Save as&quot; on the view to start saving it as a separate file.","Saving views","view")},a)}),X.on("crsa-page-reload",function(e,t){t.changed?showAlert("This page has unsaved changed. Are you sure you want to reload it?","Page has unsaved changes","Cancel","Reload",null,function(){Et.refreshPage(t,!1)}):Et.refreshPage(t,!1)}),X.on("crsa-page-refresh",function(e,t){crsaQuickMessage("Refreshing page..."),Et.refreshPage(t,!0)}),X.on("crsa-page-rename",function(e,t){showPrompt("Page url","Edit page name/url",t.url,"/page.html",null,function(e){t.rename(e),t.setPageChanged(!0),isApp()&&showAlert('Use "File -> Save as" to actually store it under the new name.',"Notice")})}),X.on("click",function(e){e.target==X.get(0)&&(d(null),e.preventDefault())}),e(document).on("keydown",function(e){return Et.processKeydownEvent(e)})}return this},clickOnMenu:function(e){setTimeout(function(){e.trigger("click")},20)},processKeydownEvent:function(t){var a=e(t.target),n=a.is("input,textarea,select")&&!a.is("#crsa-dummy-field"),r="true"==t.target.contentEditable,o=t.ctrlKey||t.metaKey;return ct&&t.ctrlKey&&t.altKey&&(o=!1),8!=t.which&&46!=t.which||n||r?68!=t.which||n||r?83==t.which&&o?(t.altKey?Et.clickOnMenu(e("#crsa-topbar .menu-file-save-all")):t.shiftKey?Et.clickOnMenu(e("#crsa-topbar .menu-file-save-as")):Et.clickOnMenu(e("#crsa-topbar .menu-file-save")),!1):82==t.which&&o?(Q&&(B.isInEdit(K)?B.refreshPreview():Et.clickOnMenu(Q.$page.find(".crsa-reload"))),!1):66==t.which&&o?(Q&&Et.clickOnMenu(Q.$page.find(".crsa-save-preview")),!1):69==t.which&&o?(Q&&(B.isInEdit(K)?B.exitEdit(!0):Et.clickOnMenu(Q.$page.find(".crsa-code"))),!1):67!=t.which||n||r?79!=t.which||n||r?90==t.which&&o?(t.shiftKey?Et.clickOnMenu(e("#crsa-redo")):Et.clickOnMenu(e("#crsa-undo")),!1):!0:(Et.clickOnMenu(e(".crsa-inline-menu .action-add-comp")),!1):(Et.clickOnMenu(e(".crsa-inline-menu .action-edit-code")),!1):(Et.clickOnMenu(e(".crsa-inline-menu .crsa-inline-menu-duplicate")),!1):(Et.clickOnMenu(e(".crsa-inline-menu .crsa-inline-menu-delete")),!1)},getEditor:function(){return H},refreshPage:function(t,a){d(null),c(null),t.loadingStart(function(){Mt(t)}),a&&(t.load_source=t.getSource()),e.fn.crsapages("reloadPage",t,function(t,a){a.frameworks_added||a.detectAndAddFrameworks(),Et.updateStructureAndWireAllElemets(a.$iframe),e.fn.crsacss("loadLessStyles",t.get(0),function(){0==a.breakpoints.length?a.getBreakpointsFromCss(function(t){t.length&&(a.setAllBreakpoints(t),crsaQuickMessage("Got responsive breakpoints from CSS.",2e3),e("body").trigger("crsa-breakpoints-changed")),Mt(a),a.loadingDone()}):(Mt(a),a.loadingDone())}),x(t)})},refreshSelectElement:function(){rt&&"element"==rt.type&&d(rt.data)},openPage:function(t,a,n,r,o){var i=0==X.find(".page").length;X.crsapages("addPage",t,function(t,r){n&&n(r);var l=(new Date).getTime();r.detectAndAddFrameworks(),t.crsa("buildTree",t);var s=(new Date).getTime()-l;console.log("Doc tree built "+s+" ms"),i&&(i=!1,U.showTreeForIframe(t),t.crsa("createTreeWidget",t,e("#crsa-tree"),getTreeRootForElement(null,t))),e("body").trigger("crsa-page-added",t.get(0)),e.fn.crsacss("loadLessStyles",t.get(0),function(){var t=function(){o&&o(r),Mt(r),r.loadingDone(),r.autoSize(),kt.onPageLoaded&&kt.onPageLoaded(r)};0==r.breakpoints.length?r.getBreakpointsFromCss(function(a){a.length&&(r.setAllBreakpoints(a),crsaQuickMessage("Got responsive breakpoints from CSS.",2e3),e("body").trigger("crsa-breakpoints-changed")),t()}):t()}),x(t),a&&a(r)},r,Mt)},getSourceOfPage:function(t){var a=getIframeDocument(t[0]),n=e(a).find("> html");return n.length>0?n[0].innerHTML:""},setSourceOfPage:function(t,a){var n=getIframeDocument(t[0]),r=e(n).find("> html");r.length>0&&(r[0].innerHTML=a)},resizeChrome:function(){A()},editCode:function(e){return B.editCode(e),this},getSelectedPage:function(){return K},getSelectedElement:function(){return rt},getSelectedCrsaPage:function(){return Q},showSelectedInsertFactory:function(t,r){var o=e("#crsa-elements"),i=o.find("ul.selected-insert"),l=i.find(">li");if(!t)return i.hide(),void 0;r=r?r:Q.getAllTypes(t);var s=[];if(e.each(r,function(e,t){t.action_menu&&t.action_menu.add&&s.push(t.action_menu)}),!s.length)return i.hide(),void 0;var c=l.find("> div > h2");c.html("Insert into <small>"+getElementName(t)+"</small>");var d=l.find(">ul").html(""),u=null,p=!1;e.each(s,function(t,a){e.each(a.add,function(t,n){var r=Q.getTypeDefinition(n);if(r){var o=e("<li/>",{"class":"crsa-factory-element crsa-factory-element-"+r.type}).html("<div>"+r.name+"</div>").data("crsa-factory-def",r);o.data("action-menu",a),o.appendTo(d)}})}),d.find("li.crsa-factory-element").off(".sfactory").on("mouseenter.sfactory",function(t){var r=e(t.delegateTarget),o=r.data("crsa-factory-def");if(!u||u!=o){if(!r.data("in-air")){var i=a(o);Et.showPreview(r,i,null,230,removeCrsaClassesFromHtml(n(o))),u=o}p||(p=!0,r.tooltip({container:"body",trigger:"manual",title:"Click to append to the selected element. Right click for placement options."}),r.tooltip("show"),setTimeout(function(){r.tooltip("destroy")
},4e3))}}).on("mouseleave.sfactory",function(){Et.hidePreview(),u=null,e(".tooltip").remove()}).on("click.sfactory",function(t){var a=e(t.delegateTarget);if(t.preventDefault(),Et.hidePreview(),rt&&"element"==rt.type){var n=a.data("action-menu"),r=a.data("crsa-factory-def");It(n,rt.data,r,!1)}}).on("contextmenu.sfactory",function(t){var a=e(t.delegateTarget),r=a.data("crsa-factory-def"),o=a.data("action-menu");if(t.stopPropagation(),t.preventDefault(),Et.hidePreview(),rt&&"element"==rt.type){var i=new CrsaContextMenu,l=getElementName(rt.data);i.add("Insert",null,null,"header"),i.add("<b>Prepend</b> to selected <b>"+l+"</b>",null,function(){It(o,rt.data,r,!1,!0),u=r}),i.add("<b>Append</b> to selected <b>"+l+"</b>",null,function(){It(o,rt.data,r,!1,!1),u=r}),isApp()&&(i.add("",null,null,"divider"),i.add("Copy code",null,function(){var e=n(r);copyCodeToClipboard(e),u=r})),i.showAt(t.pageX,t.pageY)}}),i.show()},showFactory:function(){var o=e("#crsa-elements"),i=null,l=o.find(">.header"),s=e("<input/>",{"class":"form-control filter-form",placeholder:"search"}).appendTo(l),c=e('<a href="#" class="icon-action"><i class="fa fa-cog"></i></a>').appendTo(l);c.on("click",function(t){e.fn.crsacss("showFrameworkManager",Q),t.preventDefault()}).tooltip({container:"body",placement:"right",title:"Manage frameworks and plugins for the selected page.",trigger:"hover"});var u=o.find(">.content");e('<ul class="selected-insert"><li class="section"><div><h2></h2></div><ul></ul></li></ul>').appendTo(u).hide();var p=e("<ul/>").appendTo(u),h=null,v=function(e){var t=null,a=!1;if(h=e,e){if(t=e.getLibSections(),null==Ct||null==t)a=!0;else if(Ct.length!=t.length)a=!0;else for(var n=0;n<t.length;n++)if(t[n]!=Ct[n]){a=!0;break}}else a=!0;a&&w(t)};e("body").on("crsa-page-selected",function(e,t){v(t)}),e("body").on("crsa-element-selected",function(){h!=Q&&v(Q)}),e("body").on("crsa-frameworks-changed",function(){if(w(),Q&&Q.treeTop){var t=e(getIframeBody(Q.$iframe.get(0)));t.find("*").data("crsa-def",null),t.data("crsa-def",null),Et.updateStructureAndWireAllElemets(Q.$iframe)}});var w=function(t){p.html(""),i=s.val();var r=i&&i.length>0?new RegExp(escapeRegExp(i),"i"):null;if(!Q)return Ct=null,void 0;t||(t=Q.getLibSections()),Ct=t,e.each(t,function(t,a){var n=!0;r&&(n=a.name.match(r));var o;if(a.framework.user_lib){var i=a.framework.changed?"*":"";o=e("<li/>",{"class":"section"}).html('<div><h2><a href="#" data-toggle="dropdown">'+a.name+"<small> / "+a.framework.name+i+' <span class="caret"></span></small></a></h2></div>').appendTo(p);var l=o.find("h2 > a"),s=getUniqueId("section");l.attr("data-target","#"+s);var c=e('<ul class="dropdown-menu context-menu" style="left:auto;right:0;" role="menu"></ul>'),d=o.find(">div");d.attr("id",s).css("position","relative"),e('<li><a href="#" class="add">Add as Component</a></li>').appendTo(c),e('<li><a href="#" class="save">Save</a></li>').appendTo(c),e('<li><a href="#" class="save-as">Save as...</a></li>').appendTo(c),function(e,t){t.find("a.add").on("click",function(t){if(t.preventDefault(),rt){var a=rt.data;g(a,e.framework)}else showAlert("First select the element on the page than add it to the library as component.")}),t.find("a.save").on("click",function(a){a.preventDefault(),isApp()?e.framework.localFile?e.framework.save(e.framework.localFile,function(){crsaQuickMessage("Library saved."),pinegrow.frameworksChanged()}):t.find("a.save-as").trigger("click"):F("Please use the Pinegrow desktop app to work with component libraries.")}),t.find("a.save-as").on("click",function(t){t.preventDefault(),isApp()?crsaChooseFile(function(t,a){e.framework.save(a,function(){crsaQuickMessage("Library saved."),pinegrow.frameworksChanged()})},e.framework.getFileName()):F("Please use the Pinegrow desktop app to work with component libraries.")})}(a,c),d.append(c),l.dropdown()}else o=e("<li/>",{"class":"section"}).html("<div><h2>"+a.name+"<small> / "+a.framework.name+"</small></h2></div>").appendTo(p);var u=e("<ul/>").appendTo(o),f=!0;e.each(a.getComponentTypes(),function(t,a){var o=a;if(o){if(r&&!n&&!o.name.match(r))return!0;var i=e("<li/>",{"class":"crsa-factory-element crsa-factory-element-"+o.type}).html("<div>"+o.name+"</div>").data("crsa-factory-def",o);i.appendTo(u);{i.data()}f=!1}}),!f||a.framework.user_lib&&!r||o.remove()}),p.nestedSortable("refresh");var o=null,l=!1,c=null;p.find("li.crsa-factory-element").on("mouseenter.factory",function(t){var r=e(t.delegateTarget),o=r.data("crsa-factory-def");if(!r.data("in-air")){var i=a(o);Et.showPreview(r,i,null,230,removeCrsaClassesFromHtml(n(o))),c=o}}).on("mouseleave.factory",function(){Et.hidePreview(),c=null,e(".tooltip").remove()}).on("dblclick.factory",function(e){e.preventDefault()}).on("click.factory",function(t){var a=e(t.delegateTarget);t.preventDefault(),Et.hidePreview(),l||(a.tooltip({container:"body",trigger:"manual",title:"Drag & Drop me on the page or on the tree. Right click to insert into the selected element."}),a.tooltip("show"),setTimeout(function(){a.tooltip("destroy"),l=!1},4e3),o=null,l=!0)}).on("contextmenu",function(t){var a=e(t.delegateTarget),r=a.data("crsa-factory-def"),o=r.framework;t.stopPropagation(),t.preventDefault(),Et.hidePreview();var i=new CrsaContextMenu;if(o.user_lib&&(i.add("",null,null,"divider"),i.add("Component",null,null,"header"),i.add("Rename...",null,function(){showPrompt("Enter the new name for the component:","Rename component",r.name,null,null,function(e){e&&r.name!=e&&(r.name=e,o.changed=!0,pinegrow.frameworksChanged())})}),i.add("Update",null,function(){if(rt){var e=rt.data;showAlert("Do you want to update component <b>"+r.name+"</b> with the content of element <b>"+getElementName(e,null,!1,!0,!0)+"</b>?","Confirm update","Cancel","Update it",null,function(){m(e,r,Q,!1),o.changed=!0,pinegrow.frameworksChanged(),crsaQuickMessage("Component updated")})}else showAlert("First select the element on the page that you'll use to update the component with.")}),i.add("Delete",null,function(){showAlert("Are you sure? Deleting component <b>"+r.name+"</b> can't be undone.","Confirm delete","Cancel","Delete it",null,function(){o.removeComponentType(r),o.changed=!0,pinegrow.frameworksChanged()})})),rt&&"element"==rt.type){var l=f(r,rt.data),s=getElementName(rt.data);i.add("",null,null,"divider"),i.add("Insert",null,null,"header"),i.add("Prepend to <b>"+s+"</b>",null,function(){It(l,rt.data,r,!1,!0),c=r}),i.add("Append to <b>"+s+"</b>",null,function(){It(l,rt.data,r,!1,!1),c=r}),i.add("Insert before <b>"+s+"</b>",null,function(){_t(rt.data,r,!1,!1),c=r}),i.add("Insert after <b>"+s+"</b>",null,function(){_t(rt.data,r,!1,!0),c=r})}isApp()&&(i.add("",null,null,"divider"),i.add("Copy code",null,function(){var e=n(r);copyCodeToClipboard(e),c=r})),i.showAt(t.pageX,t.pageY)})},b=(e(this),null);p.nestedSortable({helper:function(t,a){var n=e(t.target).closest("li.crsa-factory-element");if(b=n.data("crsa-factory-def"),!b)return null;factoryCopyHelper=a.clone(!0).insertAfter(a),n.data("in-air",!0),z=n,at=!1,b=n.data("crsa-factory-def");var o=r(b).data("crsa-factory-def",b);return nt=r(b),n.data("crsa-element",nt),b.drag_helper&&(o=e(b.drag_helper).data("crsa-factory-def",b)),o[0]},forcePlaceholderSize:!1,aahelper:"clone",placeholder:!1,appendTo:document.body,handle:"div",tabSize:25,tolerance:"pointer",scroll:!1,isTree:!1,items:"li.crsa-factory-element",listType:"ul",toleranceElement:"> div",aaacancel:".section",isAllowed:function(e,t){return!t||t.hasClass("crsa-factory-element")?!1:!0},connectWith:"#crsa-tree > div.tree-container > ul"}).on("sortremove",function(){}).on("sortstop",function(){factoryCopyHelper&&factoryCopyHelper.remove(),X.crsapages("showOverlays",!0);var t;if(nt){var a=getType(nt);if(t=a,nt.data("crsa-def",null),tt){var n=nt.parent();Et.updateStructureAndWireAllElemets(tt.iframe,n&&n.length>0?n:null)}d(nt),at&&!getIframeOfElement(nt)&&a.invalid_drop_msg&&showAlert(a.invalid_drop_msg,"Can't put it here")}at=!1,et=null,e.fn.crsapages("clearUndoSetFlag"),didMakeChange(K,nt,nt?nt.parent():null),nt&&Nt(nt,t),nt=null}).on("sortstart",function(){e.fn.crsapages("clearUndoSetFlag"),X.crsapages("showOverlays"),crsaEndEditModeIfActive()}).on("sort",function(e){t(e)}),w(),s.on("input",function(){w()})},setSelectedElementProperty:function(t,a){var n=e("#crsa-properties");n.find(".crsa-field").each(function(n,r){var o=e(r),i=o.data("crsa-field");if(i==t){var l=o.find("> input");return l.val(a),l.trigger("change",!0),!1}})},getValuesForElement:function(e){return i(getObjectFromElement(e))},showProperties:function(t,a,n){if("undefined"!=typeof a&&a||(a=e("#crsa-properties")),a.find(".crsa-input-color-picker").spectrum("destroy"),a.html(""),!t)return a.html('<div class="alert alert-info">'+kt.textPropsElementNotSelected+"</div>"),void 0;if(n||(n=l(t,!0)),n){var r={};if("element"==t.type){n.sections||(n.sections={});var o=Q.getAllTypes(t.data);if(o)for(var s=0;s<o.length;s++){var c=o[s];c.sections&&e.each(c.sections,function(e,t){e in r&&!r[e].inherit||(r[e]=t)})}}else r=n.sections?n.sections:{};var u=i(t,r);if(n){var p=e("<ul/>",{"class":"props-desc-obj"}).appendTo(a),f=function(){if(p.html(""),"element"==t.type){e("<li/>").html(y(t,n,!0,!0,!1,!0)).appendTo(p);var a=0,r="true"==crsaStorage.getValue("showElementParents"),o=r?999:1;if(!t.data.is("body")){for(var i=t.data.parent();i.length>0&&!i.is("body");){if(a>=o){e("<li/>",{"class":"parent"}).html('<i class="fa fa-angle-double-right"></i>').prependTo(p);break}e("<li/>",{"class":"parent"}).html(getElementName(i,null,!0,!0,!1,!0)).prependTo(p).data("crsa-element",i),i=i.parent(),a++}r&&e("<li/>",{"class":"parent"}).html('<i class="fa fa-angle-double-left"></i>').prependTo(p)}p.find("li.parent").on("click",function(t){t.preventDefault();var a=e(t.delegateTarget).data("crsa-element");a?d(e(t.delegateTarget).data("crsa-element")):(crsaStorage.setValue("showElementParents",r?"false":"true"),f())})}else e("<li/>").html(y(t,n,!0,!0,!1,!0)).appendTo(p)};f(),e.each(r,function(n,r){if(r.hasOwnProperty("show")&&!r.show||!r.name)return!0;var o=(e("<h2/>").html(r.name).appendTo(a),e("<div/>").appendTo(a));e.each(r.fields,function(e,a){"custom"==a.type?a.show(o,t,e,a,u):Et.addInputField(o,t,e,a,u)})})}}},addInputField:function(t,a,n,r,o,i){var l=e("<div/>",{"class":"crsa-field crsa-field-"+r.type}).appendTo(t).data("crsa-field",n).data("crsa-field-def",r);r.name&&l.append("<label>"+r.name+"</label>");var s=null,c=null;switch(r.type){case"select":s=e("<select/>",{"class":"crsa-input"}).appendTo(l),r.show_empty&&e("<option/>",{value:dt}).html("").appendTo(s);var d=xt(r,a);if(e.each(d,function(t,a){e("<option/>",{value:a.key}).html(a.name).appendTo(s)}),o[n]?s.val(o[n]):r.show_empty&&s.val(dt),r.rich){var u=e("<div/>",{"class":"crsa-select-val"}).appendTo(l);c=new CrsaSelect(s,u,d,r.rich),l.addClass("rich-select")}break;case"rules":k(l,a.data,o,n);break;case"text":case"color":case"slider":case"image":case"media-query":s=e("<input/>",{type:"text","class":"crsa-input crsa-input-"+r.type}).appendTo(l),o[n]&&s.val(o[n]);break;case"checkbox":s=e("<input/>",{type:"checkbox",value:r.value,"class":"crsa-input crsa-input-"+r.type}).appendTo(l),o[n]&&s.prop("checked","checked")}if("image"==r.type||r.file_picker){var p=e("<a/>",{href:"","class":"crsa-pick-file"}).html('<i class="fa fa-folder-open"></i>').appendTo(l);p.on("click",function(t){var n=e(t.delegateTarget).closest(".crsa-field").find(".crsa-input");return isApp()?crsaChooseFile(function(e){var t=crsaGetObjectParentUrl(a);t&&(e=crsaIsFileUrl(t)?crsaMakeLinkRelativeTo(e,t):e.replace("file://",q.url+"/")),r.file_picker_quotes&&e&&(e='"'+e+'"'),n.val(e).trigger("change")}):(ht=new CrsaProjectBrowser,ht.setProjects([crsaProject]),ht.title="Select image",ht.onFileSelected=function(e){var t=e.url;r.file_picker_quotes&&t&&(t='"'+t+'"'),n.val(t).trigger("change")},ht.show()),t.preventDefault(),void 0;var n})}if("slider"==r.type){{e("<p/>",{"class":"crsa-slider"}).appendTo(l)}s.on("focus",function(){showNotice("<p>Use <b>UP</b> and <b>DOWN arrow keys</b> to change value. Press <b>SHIFT</b> to increase or decrease by 10 units.</p>","A Tip","arrow-css-value",function(){setTimeout(function(){},100)},!0)}),s.on("keydown",function(e){if(38==e.which||40==e.which){e.preventDefault();var t=s.val();t||(t="0px"),t=t.replace(/(\-?[0\.-9]+)(px|em|rm|pt|%)/g,function(t){var a=t.replace(/[\-0-9\.]/g,""),n=1,r=!0;t.indexOf(".")>=0&&(n=.1,r=!1);var o=r?parseInt(t):parseFloat(t);switch(e.which){case 38:o+=e.shiftKey?10*n:n;break;case 40:o-=e.shiftKey?10*n:n}return(r?o:o.toFixed(2).replace(".00",".0").replace(/(\.[0-9])0/,"$1"))+a}),s.val(t),s.trigger("input")}})}if("media-query"==r.type&&!function(){var t=null,a=e("<a/>",{href:"","class":"crsa-pick-file"}).html('<i class="fa fa-magic"></i>').appendTo(l);s.addClass("crsa-has-icon"),a.on("click",function(e){e.preventDefault(),t&&!t.closed?(t.close(),t=null):t=Q.showMediaQueryHelper(s)})}(),"color"==r.type){var f=e("<input/>",{type:"text","class":"crsa-input-color-picker"}).appendTo(l);!o[n];var g,m=!1;s.on("input change",function(){m||f.spectrum("set",s.val())});var h=function(e){m=!0;var t=s.get(0).selectionStart,a=s.get(0).selectionEnd;if(t>=0&&a>t){var n=s.val(),r=n.substr(0,t)+e+n.substr(a,n.length-a);s.val(r),s.get(0).selectionEnd=t+e.length,s.get(0).selectionStart=t}else r=e,s.val(r);return s.trigger("input"),m=!1,r},v=function(e){if(1!=e.alpha)return e.toRgbString();var t=e.toString();return t};f.spectrum({showAlpha:!0,clickoutFiresChange:!1,showInitial:!0,showInput:!0,preferredFormat:"hex",showPalette:!0,palette:[],beforeShow:function(){return g=s.val(),!0},move:function(e){h(v(e))},show:function(){},change:function(e){g=h(v(e))},hide:function(){g!=s.val()&&(m=!0,s.val(g),s.trigger("input"),m=!1)}}),f.spectrum("set",s.val())}var w=null;if(s&&!i){var b=s.is("select")?"change":"input change";s.on(b,function(t,n){var r,i=e(t.delegateTarget),l=i.closest(".crsa-field"),s=l.data("crsa-field"),c=l.data("crsa-field-def");if(r="checkbox"==c.type?i.prop("checked")?c.value:null:i.val(),c.hasOwnProperty("live_update")&&!c.live_update&&"input"==t.type)return!0;w&&w==s||n||(getCrsaPageForIframe(K).undoStack.add("Change "+c.name+" / "+y(a)),console.log("undo recorded"),w=s),"change"==t.type&&(w=!1),(r==dt||""==r)&&(r=null);var d=o[s]?o[s]:null;try{o[s]=Et.propertyChanged(a,s,r,d,c,l,t.type,o),r!=o[s]&&i.val(o[s]),G?(Z||"element"!=a.type||(Z=a.data),Et.updateIfNeeded()):"change"==t.type&&K&&setTimeout(function(){getCrsaPageForIframe(K).autoSize()},100),didMakeChange(K,"element"==a.type?a.data:null)}catch(u){showAlert(u.toString(),"Can't edit this element"),i.val(d)}})}return l},updateIfNeeded:function(){G&&(Et.updateStructureAndWireAllElemets(K,Y,!0),Z&&(d(Z),Z=null))},propertyChanged:function(t,a,n,r,o,l,s,c){var u=null,p="element"==t.type?getCrsaPageOfElement(t.data):null,f=o.action?o.action:"style";if(o.negvalue&&null==n&&(n=o.negvalue),"none"!=f){if(o.set_value)try{var g=o.set_value(t,n,c,r,s);g!=n&&(n=g,l.find("> input.crsa-input").val(n))}catch(m){console.log("set_value had an exception: "+m)}else if("style"==f){if("element"==t.type){var h=t.data,v=h.attr("id");v||(v=getUniqueId(),h.attr("id",v)),u="#"+v}else if("rule"==t.type){var w=t.data;w.crsa_stylesheet.genRuleValueChanged(w,a,n),"image"==o.type&&(n="url("+n+")")}}else if("apply_class"==f){if("element"==t.type){var h=t.data,b=xt(o,t),y=!0;if(p&&p.sourceNode){var C=getElementPgNode(h),T=new pgParserSourceProblem(C,h);if(C?b?e.each(b,function(e,t){return t.key==n?!0:(h.hasClass(t.key)&&(C.canRemoveClass(t.key)||T.add("class",t.key,"remove")),void 0)}):r&&r!=n&&h.hasClass(r)&&(C.canRemoveClass(r)||T.add("class",r,"remove")):T.add("element",getElementName(h),"change"),!T.ok())throw y=!1,T;b?e.each(b,function(e,t){return t.key==n?!0:(h.hasClass(t.key)&&C.removeClass(t.key),void 0)}):r&&r!=n&&h.hasClass(r)&&C.removeClass(r),n&&C.addClass(n)}y&&(b?e.each(b,function(e,t){h.hasClass(t.key)&&h.removeClass(t.key)}):o.value,r&&h.hasClass(r)&&h.removeClass(r),n&&h.addClass(n))}}else if("element_id"==f){if("element"==t.type){var h=t.data;if(p&&p.sourceNode){var C=getElementPgNode(h),T=new pgParserSourceProblem(C,h);if(C||T.add("element",getElementName(h),"change"),!T.ok())throw T;C.setAttr("id",n)}h.attr("id",n)}}else if("element_attribute"==f){if("element"==t.type){var h=t.data;if(p&&p.sourceNode){var C=getElementPgNode(h),T=new pgParserSourceProblem(C,h);if(C||T.add("element",getElementName(h),"change"),!T.ok())throw T;o.empty_attribute?n?C.setAttr(o.attribute,""):C.removeAttr(o.attribute):C.setAttr(o.attribute,n)}o.empty_attribute?n?h.attr(o.attribute,""):h.removeAttr(o.attribute):h.attr(o.attribute,n)}}else if("element_html"==f){if("element"==t.type){var h=t.data;h.html(n)}}else if("rules"==f){if("element"==t.type){var h=t.data;h.attr("class",n)}}else if("rule_name"==f){if("rule"==t.type){{var w=t.data;"class"==w.type?w.class:null}t.selector=n,K.crsacss("renameLessRule",w,n,function(e,a){t.data=e,a&&Et.updateStructureAndWireAllElemets(K),rt&&"element"==rt.type&&d(rt.data)})}}else if("rule_media"==f){var w=t.data;if(w.crsa_stylesheet.genRuleValueChanged(w,"media",n),"change"==s){if(rt&&"element"==rt.type){var S=i(rt),P=l.parent().closest(".crsa-field");P.html(""),k(P,rt.data,S,"rules"),Et.showProperties(t,P.find("> .crsa-rule-props"))}e("body").trigger("crsa-rules-changed")}}return o.on_changed&&o.on_changed(t,a,n),n}},showVariables:function(){K.crsacss("showVariables")},showTab:function(e){S(e)},setSelectedPage:function(e){Dt(e)},updateStructureAndWireAllElemets:function(t,a,n){var r=(new Date).getTime();t&&Et.buildTree(t,a);var o,i=e("#crsa-tree"),l=i.scrollTop(),s=getTreeRootForElement(a,t);if(o=a?kt.getTreeRootForElement?s:a:s,Et.createTreeWidget(t,i,s,o,function(){i.scrollTop(l)}),t){G=!1,Y=null;var c=getCrsaPageForIframe(t);c.scrollMode||X.crsapages("autoSizePage",t,c.scrollMode),J&&!n&&(J.remove(),J=null),rt&&"element"==rt.type&&!n&&d(rt.data);{(new Date).getTime()-r}return this}},setNeedsUpdate:function(e,t){var a=t?getIframeOfElement(t):K;G=!0,Y=t,e&&(it&&(clearTimeout(it),it=null),Et.updateStructureAndWireAllElemets(a,t),rt&&"element"==rt.type&&d(rt.data))},setNeedsUpdateDelayed:function(e){it&&(clearTimeout(it),it=null),it=setTimeout(function(){Et.setNeedsUpdate(!0,e)},500)},setSelectElementOnUpdate:function(e){Z=e},showPreview:function(t,a,n,r,o){gt||(gt=e("<div/>",{id:"crsa-preview","class":"preview"}).html('<div class="content clearfix"></div><div class="pre-holder"><pre></pre></div>').appendTo(e("body")));var i=a,l=gt.find(">div.content");if(i?l.show():(i=e('<div style="display:none;"></div>'),l.hide()),i){l.html("").append(i),n&&gt.addClass(n).data("custom-class",n);var s=gt.find(">div.pre-holder pre");o?(o=pinegrow.formatHtml(o),s.html(escapeHtmlCode(o)),s.parent().show()):s.parent().hide();var c=t.offset(),d=e(window).height(),u=gt.height(),p=r?r:c.left+t.width()+20,f=c.top-u/2;f+u>d&&(f=d-u),gt.css({left:p+"px",top:f+"px"}),gt.show()}},hidePreview:function(){if(gt){gt.hide().find(">div.content").html("");var e=gt.data("custom-class");e&&gt.removeClass(e).data("custom-class",null)}},isCollapsed:function(e){var t=getTreeNodeForElement(e);return t&&t.hasClass("collapsed")},collapseElement:function(e,t){("undefined"==typeof t||null===t)&&(t=!Et.isCollapsed(e));var a=getTreeNodeForElement(e),n=a.find(">div .fa-angle-down, >div .fa-angle-right");if(a){var r=a.find("> ul");r.length>0&&(t?(n.addClass("fa-angle-right").removeClass("fa-angle-down"),e.data("crsa-tree-collapsed",!0),a.addClass("collapsed"),r.animate({height:0},250,function(){r.addClass("crsa-tree-node-closed"),rt&&"element"==rt.type&&rt.data.get(0)==e.get(0)&&d(rt.data)})):(n.addClass("fa-angle-down").removeClass("fa-angle-right"),a.removeClass("collapsed"),e.data("crsa-tree-collapsed",null),r.removeClass("crsa-tree-node-closed"),r.css("height",0),r.animate({height:r.get(0).scrollHeight},250,function(){r.css("height",""),rt&&"element"==rt.type&&rt.data.get(0)==e.get(0)&&d(rt.data)})))}},wireElement:function(t,a,n,r){var o=t,i=getType(t,!1,!0,r);if(i&&i.empty_placeholder){var l="string"==typeof i.empty_placeholder?i.empty_placeholder:"pg-empty-placeholder",s=t.get(0).innerHTML.length<10&&""==e.trim(t.html());s||t.removeClass(l)}null==o.data("has-crsa-events")&&(o.on("mouseover.crsa",function(t){if(ft)return!0;if(!nt){var a=e(t.delegateTarget);if(!getType(a))return!0;c(a),t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault()}}).on("mouseout.crsa",function(t){if(ft)return!0;if(!nt){var a=e(t.delegateTarget);if(!getType(a))return!0;c(null),t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault()}}).on("click",function(t,a){if(ft||a)return!0;if(t.shiftKey)return!0;var n=e(t.delegateTarget);return getType(n)?n.attr("data-pg-allow-click")?(r.allowReload=!0,t.stopPropagation(),!0):(d(n),t.stopImmediatePropagation(),t.preventDefault(),mt.trigger("click"),void 0):!0}).on("dblclick.crsa",function(t){if(ft)return!0;var a=e(t.delegateTarget);return getType(a)?(H.setSelectedPage(r.$iframe),H.startEdit(e(".crsa-edit-toolbar"),a),t.preventDefault(),t.stopImmediatePropagation(),!0):!0}).on("input.crsa",function(t){if(ft)return!0;var a=e(t.delegateTarget);a.is("input")&&crsaQuickMessage("Please edit field initial value in PROPs",2e3,!0)}),o.data("has-crsa-events",!0))},buildTree:function(t,a){var n=getIframeBody(t[0]),r=getCrsaPageForIframe(t);a&&(n=a.get(0));var o=kt&&kt.nodeFilter?kt.nodeFilter:null;Ot(n,function(a){if(1==a.nodeType){var n=e(a);Et.wireElement(n,t,null,r)}},o)},traceTree:function(t){var a=e(getIframeBody(t[0]));walkCrsaTreeLevel(a,0,function(e,t){for(var a=getType(t,!1),n="",r=0;e>r;r++)n+="----";n=n+" "+a.name+" "+t[0].tagName,T(n)})},createTreeWidget:function(e,t,a,n,r){st=a,U.paintTree(e,n?n:a,function(){r&&r()}),Dt(e)},highlightElement:function(e){return c(e)},selectElement:function(e){d(e)},scrollCanvasToElement:function(e){scrollCanvasToElement(e)},willMakeChange:function(e,t){willMakeChange(e,t)},didMakeChange:function(e){didMakeChange(e)}},Dt=function(t){K&&K.closest(".page").removeClass("active");var a=null==K||null==t||K.get(0)!=t.get(0);if(K=t,H.setSelectedPage(t),K?(K.closest(".page").addClass("active"),Q=getCrsaPageForIframe(K)):Q=null,a){try{pt.setSelectedPage(K),Et.showVariables(),K&&Q.autoSize(),U.showTreeForIframe(K)}catch(n){}e("body").trigger("crsa-page-selected",Q)}};e.fn.crsa.defaults={types:{},rulesDefintion:{},rules:{},variables:{},lib:{},frameworks:{}},e.fn.crsa.addFramework=function(t){e.fn.crsa.defaults.frameworks[t.key]=t},e.fn.crsa.addLibSection=function(t,a){e.fn.crsa.defaults.lib[t]={name:a,elements:[]}},e.fn.crsa.addElementsToLibSection=function(t,a){t in e.fn.crsa.defaults.lib||T("Lib section "+t+" not found."),e.fn.crsa.defaults.lib[t].elements=e.fn.crsa.defaults.lib[t].elements.concat(a)},e.fn.crsa.addDefinition=function(t){"priority"in t||(t.priority=1e3),e.fn.crsa.defaults.types[t.type]=t},e.fn.crsa.addRulesDefinition=function(t){e.fn.crsa.defaults.rulesDefinition=t},e.fn.crsa.addVariablesSection=function(t,a){return t in e.fn.crsa.defaults.variables||(e.fn.crsa.defaults.variables[t]={name:a,list:{}}),e.fn.crsa.defaults.variables[t]},e.fn.crsa.addVariable=function(t,a,n,r,o){var i=e.fn.crsa.addVariablesSection(o,o);return i.list[t]={name:a,type:n,value:r,key:t},i.list[t]},e.fn.crsa.addRulesSection=function(){},e.fn.crsa.addRule=function(){};var It=function(e,t,a,n,o){var i=r(a),l=getElementName(i,a);return willMakeChange(K,"Add element / "+l),e&&e.on_add?e.on_add(t,i,a,o):o?t.prepend(i):t.append(i),i.data("crsa-def",null),n&&d(i),Et.updateStructureAndWireAllElemets(K,i.parent(),!n),didMakeChange(K,i,i.parent()),Nt(i,a),crsaQuickMessage("Element <b>"+l+"</b> was inserted."),i},_t=function(e,t,a,n){var o=r(t),i=getElementName(o,t);return willMakeChange(K,"Add element / "+i),n?o.insertAfter(e):o.insertBefore(e),o.data("crsa-def",null),a&&d(o),Et.updateStructureAndWireAllElemets(K,e.parent(),!a),didMakeChange(K,o,e.parent()),Nt(o,t),crsaQuickMessage("Element <b>"+i+"</b> was inserted."),o},Ft=function(){var t=e("#crsa-placer"),a=t.find(".panel-content");this.def=null,this.$element=null,this.clone=!1,this.$cloneSource=null,this.$target=null,this.undoRecorded=!1;var n=this;mt.on("crsa-element-selected",function(e,a){if(t.is(":visible"))if(a&&"element"==a.type){this.undoRecorded=!1;var r=a.data,o=getIframeOfElement(r);n.$target=r,n.$element&&n.$element.get(0)==r.get(0)||i(o,r,n.$element,n.def)}else i(null,null,n.$element,n.def)});var o=function(){return rt&&"element"==rt.type?n.$element&&rt.data.get(0)==n.$element.get(0)?rt.data.is("body")?null:rt.data.parent():rt.data:null};this.setDef=function(e){this.def=e,this.$element=null,this.clone=!1,this.$cloneSource=null,this.$target=this.$target?this.$target:o(),this.undoRecorded=!1,i(K,this.$target,null,n.def)},this.setElement=function(t,a){this.$element=t,this.clone=a,this.$cloneSource=a?t:null,this.def&&(e("li.crsa-factory-element.selected").removeClass("selected"),this.def=null);var n=o();this.$target=n,a&&(this.$element=t.clone(!0),removeCrsaClasses(this.$element)),this.undoRecorded=!1,i(K,n,this.$element,null)};var i=function(o,l,s){t.find("div.crsa-drop-target").remove();var u=e('<div class="crsa-drop-target"></div>'),p=u,f=n.def;if(s?f=getType(s):n.$cloneSource&&(f=getType(n.$cloneSource)),o&&l&&f){e('<div class="alert alert-info">Select the position for <strong>'+f.name+"</strong>:</div>").appendTo(p);var g=l,m=[];if(!l.is("body"))do{if(g=g.parent(),0==g.length)break;m.push(g.get(0))}while(!g.is("body")&&m.length<3);for(var h=!1,v=m.length-1;v>=0;v--){var w=e(m[v]);p=e('<div class="crsa-drop-parent"></div>').html(getElementName(w,null,!0,!1,!1)).appendTo(p).data("parent",w)}p=e('<div class="crsa-drop-selected"></div>').appendTo(p),e("<span/>").html(getElementName(l,null,!0,!1,!1)).appendTo(p);var b=l.children().filter(function(){return getType(e(this))?!0:!1});e("<div/>",{"class":"crsa-drop-loc crsa-drop-loc-prepend"}).data("loc","prependTo").data("loc-el",l).appendTo(p),b.each(function(t,a){var n=e(a);e("<div/>",{"class":"crsa-drop-child"}).data("child",n).html(getElementName(n,null,!0,!1,!1)).appendTo(p),t!=b.length-1&&e("<div/>",{"class":"crsa-drop-loc crsa-drop-loc-after"}).data("loc","insertAfter").data("loc-el",n).appendTo(p)}),e("<div/>",{"class":"crsa-drop-loc crsa-drop-loc-append"}).data("loc","appendTo").data("loc-el",l).appendTo(p);var y=function(e){crsaWillChangeDom();var t=e.data("loc"),a=e.data("loc-el");s||(s=n.$cloneSource?n.$cloneSource.clone(!0):r(f),removeCrsaClasses(s)),s[t](a),scrollCanvasToElement(s,o)};p.find(".crsa-drop-loc").on("mouseover",function(t){var a=e(t.delegateTarget);y(a),c(s),s.addClass("crsa-placed")}).on("mouseout",function(){s&&(s.detach(),c(null),s.removeClass("crsa-placed"))}).on("click",function(a){a.preventDefault(),a.stopPropagation();var r=e(a.delegateTarget);n.undoRecorded||(s&&s.detach(),willMakeChange(o,"Placed / "+f.name),s&&y(r),n.undoRecorded=!0),h=!0,s||y(r),s.removeClass("crsa-placed"),Et.updateStructureAndWireAllElemets(o,s.parent(),!0),c(null),didMakeChange(o,s.parent()),Nt(s),s=null;var d=u.scrollTop();i(o,l,s),t.find("div.crsa-drop-target").scrollTop(d)}),p.find(".crsa-drop-child").on("mouseover",function(t){var a=e(t.delegateTarget).data("child");c(a),scrollCanvasToElement(a,o)}).on("mouseout",function(t){e(t.delegateTarget).data("child");c(null)}).on("click",function(t){t.preventDefault(),t.stopPropagation();var a=e(t.delegateTarget).data("child");d(a),scrollCanvasToElement(a,o),i(o,a,s)}),u.find(".crsa-drop-parent").on("click",function(t){t.preventDefault(),t.stopPropagation();var a=e(t.delegateTarget).data("parent");d(a),scrollCanvasToElement(a,o),i(o,a,s)})}else e('<div class="alert alert-info">Select the target element...</div>').appendTo(p);a.append(u),t.is(":visible")||t.show()}};window.crsaQuickMessage=function(t,a,n){a||(a=1500);var r=100,o=0;e(".quick-message").each(function(t,a){var n=e(a),i=parseInt(n.css("top"));i>=r&&(r=i+n.outerHeight()+0),o++}),n&&o>0||!function(){var n=e("<div/>",{"class":"quick-message"}).html("<p>"+t+"</p>").appendTo(e("body")).css("opacity",0).css("top",r+"px");n.animate({opacity:1},250),setTimeout(function(){n.animate({opacity:0},500,function(){n.remove()})},a),setTimeout(function(){n.remove()},a+1e3)}()},window.crsaGetCustomLogic=function(){return kt};var Mt=function(e){try{!e.loaded||K&&K.get(0)!=e.$iframe.get(0)||(pt.refresh(),Et.showVariables())}catch(t){}};window.getTreeRootForElement=function(t,a){return kt&&kt.getTreeRootForElement?kt.getTreeRootForElement(t,a):a?e(getIframeBody(a.get(0))):null},window.getElementPositionInCanvas=function(e,t){var a=X.crsapages("getZoom"),n=t.position(),r=t.closest(".page"),o=r.position(),i=e?e.offset():{top:0,left:0},l=i.left*a+n.left+0*o.left,s=i.top*a+n.top+o.top+X.scrollTop()-t.contents().scrollTop()*a;return{left:l,top:s}},window.scrollCanvasToElement=function(e,t){var a=t?t:getIframeOfElement(e);e&&scrollToElementInIframe(e,a);var n=getElementPositionInCanvas(e,a);if(X.scrollTop()<=n.top&&X.scrollTop()+X.height()>n.top);else{var r=n.top-100;0>r&&(r=0),X.animate({scrollTop:r},250,function(){})}},window.scrollToElementInIframe=function(t,a){var n=a.contents(),r=e(a.get(0).contentWindow).height(),o=n.scrollTop(),i=t.offset().top;(o>i||i>o+r)&&(i>=r/3&&(i-=Math.floor(r/3)),n.scrollTop(i))},window.scrollCanvasToPage=function(e){scrollCanvasToElement(null,e)};var xt=function(e,t){return e.options?"function"==typeof e.options?e.options(e,t):e.options:null},Ot=function Rt(e,t,a,n){var r=a?a(e,n):!0;for((r||"aaBODY"==e.tagName)&&t(e),e=e.firstChild;e;)Rt(e,t,a,r||n),e=e.nextSibling};window.willMakeChange=function(e,t){crsaIsInEdit()&&H.endEdit(),getCrsaPageForIframe(e).undoStack.add(t)},window.didMakeChange=function(t,a,n,r){var o=getCrsaPageForIframe(t);if(o.setPageChanged(!0),a||n){var i,l=n?n:a;do i=getType(l),i&&i.on_changed&&i.on_changed(l,o),l=l.parent();while(l.length>0&&!l.is("html"))}kt.onPageChanged&&kt.onPageChanged(t,a);var s=e.fn.crsapages("getAllPages");e.each(s,function(e,t){return t==r?!0:(t.live_update==o&&t.onPageChanged(o),o.live_update==t&&(t.onPageChanged(o),didMakeChange(t.$iframe,null,null,o)),void 0)}),B.isInEdit(o.$iframe)&&B.pageChanged(o)};var Nt=function(e,t){var a=getType(e);if(a&&a.on_inserted){var n=getCrsaPageForIframe(getIframeOfElement(e));a.on_inserted(e,n)}if(t&&t!=a&&t.on_inserted){var n=getCrsaPageForIframe(getIframeOfElement(e));t.on_inserted(e,n)}var r=e.parent();do{if(a=getType(r),a&&a.on_child_inserted){var n=getCrsaPageForIframe(getIframeOfElement(e));a.on_child_inserted(r,e,n)}r=r.parent()}while(r.length>0&&!r.is("html"));t&&t.empty_placeholder&&"1"==pinegrow.getSetting("show-placeholders","1")&&showNotice("<p><b>Empty "+e.get(0).tagName+' </b>was just added to the page. Pinegrow added <b>pg-empty-placeholder</b> class to it, with <code>min-height:100px</code> so that you can see the element on the page. Once you add content to the element the class is removed. This does not affect how page looks like outside of Pinegrow - it\'s just a help to make editing easier.</p><p>You can enable or disable this behaviour in Support -&gt; Settings.</p><p><a href="http://docs.pinegrow.com/solution/articles/1000085418-placeholders-for-empty" class="external" target="_blank">Read more about placeholders.</a></p>',"A note about empty elements","empty-placeholder-2")},$t=function(e,t){var a=getType(e);a&&a.on_deleted&&a.on_deleted(e,t)},jt=function(e,t,a){var n=getType(e);n&&n.on_moved&&n.on_moved(e,t,a)},Lt=function(){var t='<div id="crsa-topbar" class="navbar navbar-inverse">            <div class="navbar-header">                <a class="navbar-brand external-link" href="http://pinegrow.com" target="_blank"><img src="images/logo_36.png" height="18" /><span class="sr-only">Pinegrow Web Designer</span></a>            </div>            <div class="" id="main-navbar">                <ul class="nav navbar-nav">                    <li class="dropdown menu-file"><a href="#" class="dropdown-toggle menu-file" data-toggle="dropdown">File <b class="caret"></b></a>                        <ul class="dropdown-menu">                            <li><a href="#" class="menu-file-template">New page...</a></li>                            <li><a href="#" class="menu-file-open-file">Open file...</a></li>                            <li><a href="#" class="menu-file-open-url">Open from url...</a></li>                            <li class="divider menu-save-divider"></li>                            <li><a href="#" class="menu-file-save">Save</a></li>                            <li><a href="#" class="menu-file-save-html">Save HTML only</a></li>                            <li><a href="#" class="menu-file-save-as">Save as...</a></li>                            <li><a href="#" class="menu-file-save-all">Save all</a></li>                            <li class="divider"></li>                            <li><a href="#" class="menu-file-close">Close page</a></li>                            <li><a href="#" class="menu-file-close-all">Close all</a></li>                            <li class="divider menu-project-divider"></li>                            <li><a href="#" class="menu-file-save-project">Remember project</a></li>                            <li><a href="#" class="menu-file-load-project">Load project</a></li>                            <li><a href="#" class="menu-file-download">Download project Zip</a></li>                            <li class="divider"></li>                            <li><a href="#" class="menu-file-cache">Clear cache</a></li>                            <li><a href="#" class="menu-file-manage-ss">Manage stylesheets...</a></li>                            <li><a href="#" class="menu-file-manage-fm">Manage frameworks...</a></li>                            <li><a href="#" class="menu-dev-tools">Development tools</a></li>                            <li><a href="#" class="menu-file-new-window">Open new window</a></li>                        </ul>                    </li>                    <li><a id="crsa-undo" href="#">Undo</a></li>                    <li><a id="crsa-redo" href="#">Redo</a></li>                    <li class="dropdown menu-file"><a href="#" class="dropdown-toggle menu-support" data-toggle="dropdown">Support <b class="caret"></b></a>                        <ul class="dropdown-menu">                           <!-- <li><a href="#" class="menu-support-tour">Guided tour</a></li>-->                            <li><a href="#" class="menu-support-tutorial">Tutorial - How to use Pinegrow</a></li>                            <li><a href="http://docs.pinegrow.com" target="_blank" class="menu-support-portal">Learning Center &amp; Support</a></li>                            <li><a href="http://pinegrow.com/bootstrap-docs.html" target="_blank" class="menu-support-docs">Interactive Bootstrap Docs</a></li>                            <li class="divider"></li>                            <li><a href="#" class="menu-support-settings">Settings...</a></li>                            <li class="divider"></li>                            <li><a href="#" class="menu-support-contact">Contact...</a></li>                            <li><a href="#" class="menu-support-about">About...</a></li>                            <li><a href="#" class="menu-support-new">What&#39;s new...</a></li>                        </ul>                    </li>                </ul>                <form class="navbar-form navbar-left" id="crsa-zoom">                    <div class="btn-group">                        <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">Zoom <span class="caret"></span>                        </button>                        <ul class="dropdown-menu" role="menu">                            <li><a href="#">Zoom</a></li>                        </ul>                    </div>                    <div class="checkbox">                        <label class="control-label">                        &nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="crsa-preview-switch" value="1">&nbsp;Test clicks&nbsp;&nbsp;&nbsp;&nbsp;                        </label>                    </div>                </form>                <ul class="nav navbar-nav pull-right trial">                    <li><span>You\'re playing with a trial version.</span> <a href="#">Upgrade to the Real Thing.</a></li>                </ul>            </div>        </div>';
kt.navBar&&(t=kt.navBar);var a=t+'        <div class="canvas">            <div class="empty-canvas">                <p><a href="#" class="menu-file-template"><b>New page...</b></a></p>                <p><a href="#" class="menu-file-open-file"><b>Open file...</b></a></p>                <p><a href="#" class="menu-file-open-url"><b>Open from url...</b></a></p>                <p><a href="#" class="menu-file-load-project"><b>Load saved project</b></a></p><br/>                <p><a href="#" class="menu-support-tutorial">Play with Pinegrow tutorial...</a></p>                <p><a href="http://docs.pinegrow.com" target="_blank" class="menu-support-portal">Learning Center &amp; Support</a></p>                <div class="version-info"></div>            </div>        </div>            <div id="crsa-left-plane" class="tabbable">                 <i class="hider fa fa-angle-double-left"></i>                <ul class="nav nav-tabs">                    <li class="active"><a href="#tab1" data-toggle="tab">Lib</a></li>                    <li><a href="#tab2" data-toggle="tab">Prop</a></li>                    <li><a href="#tab3" data-toggle="tab">CSS</a></li>                    <li><a href="#tab4" data-toggle="tab">Vars</a></li>                </ul>                <div class="tab-content">                    <div class="tab-pane active" id="tab1">                        <div id="crsa-elements" class="crsa-panel">                            <div class="header"></div>                            <div class="content"></div>                        </div>                    </div>                    <div class="tab-pane" id="tab2">                        <div id="crsa-properties" class="crsa-properties crsa-panel">                        </div>                    </div>                    <div class="tab-pane" id="tab3">                        <div id="crsa-rules" class="crsa-panel">                        </div>                        <div id="crsa-rule-edit" class="crsa-properties crsa-panel">                        </div>                    </div>                    <div class="tab-pane" id="tab4">                        <div id="crsa-vars" class="crsa-panel">                        </div>                    </div>                </div>            </div>        <div id="crsa-rules-out"><div class="panel-head"><i class="fa fa-bars"></i>Element rules</div><div class="panel-content"></div></div>        <div id="crsa-placer" class="crsa-panel"><div class="panel-head"><i class="fa fa-bars"></i>Placer</div><div class="panel-content"></div></div>        <div id="crsa-tree"></div>        <div id="textedit"></div>        <div id="textedit_bar">            <div class="btn-group btn-group-sm">            <a href="#" class="btn btn-info edit-html">Html</a>            <a href="#" class="btn btn-info  edit-css">                Css                <select class="edit-css-select"/>            </a>          <!--  <a href="#" class="edit-js">Javascript</a>            <a href="#" class="edit-refresh">Refresh</a> -->            <a href="#" class="btn btn-default edit-done">Done</a>            </div>            <div class="btn-group btn-group-sm pull-right">                <button href="#" class="btn btn-link edit-refresh">                        <input type="checkbox" class="live-update">&nbsp;Refresh!</button>            </div>        </div>        <div class="crsa-edit-toolbar"></div>        <input id="crsa-dummy-field" style="position:absolute;top:-1000px;" />';e("body").append(a),new CrsaPanel(e("#crsa-rules-out")),e("#crsa-rules-out").hide(),new CrsaPanel(e("#crsa-placer")),e("#crsa-placer").hide(),isApp()&&e(".external-link").on("click",function(t){t.preventDefault();var a=require("nw.gui"),n=e(t.delegateTarget).attr("href");a.Shell.openExternal(n)})};window.getPageSource=function(t){var a=getIframeDocument(t.get(0)),n=e(a).find("> html"),r=n.length>0?n[0].innerHTML:"";return r=r.replace(/(<[^>]*)\s*contenteditable="true"/gi,"$1"),r=r.replace(/(<[^>]*)\s*style=""/gi,"$1"),r=removeCrsaClassesFromHtml(r)},window.setPageSource=function(t,a,n,r){var o=getIframeDocument(t.get(0)),i=e(o).find("> html");i[0].innerHTML=a,r||setTimeout(function(){e.fn.crsacss("loadLessStyles",t.get(0),function(){Et.updateStructureAndWireAllElemets(t),e("body").trigger("crsa-stylesheets-changed"),n&&n()})},500)}}(jQuery);var CrsaPanel=function(e){this.$el=e,e.data("panel",this);{var t=this,a=$(window),n=(e.find("> .panel-head"),e.find("> .panel-content")),r=n.position().top;$("<a/>",{href:"#","class":"panel-close"}).html('<i class="fa fa-times" />').appendTo(this.$el).on("click",function(e){t.hide(),e.preventDefault()})}e.addClass("panel"),this.autoSize=function(e){e||(e=this.$el.offset());var t=(this.$el.height(),a.height()),o=t-e.top;this.$el.css("height",o+"px"),n.css("height",o-r+"px")},this.autoSize(),e.draggable({handle:".panel-head"}).on("dragstart",function(){bh=a.height(),$.fn.crsapages("showOverlays")}).on("drag",function(e,a){t.autoSize(a.offset)}).on("dragstop",function(){$.fn.crsapages("showOverlays",!0)}),this.show=function(){this.$el.show(),this.autoSize()},this.hide=function(){this.$el.hide()}},crsaHasChanges=function(){var e=!1,t=$.fn.crsapages("getAllPages");return $.each(t,function(t,a){e=e||a.changed}),e=e||pinegrow.hasUnsavedFrameworks()},crsaLoadedScripts={},crsaLoadScript=function(e,t){var a={};return e in crsaLoadedScripts?(t(),void 0):(a=$.extend(a||{},{dataType:"script",cache:!0,url:e}),jQuery.ajax(a).done(function(){crsaLoadedScripts[e]=!0,t()}))},gaNoCookieSendHit=function(e,t,a){var n=parseInt(99999999*Math.random());localStorage.gaNoCookieUid||(localStorage.gaNoCookieUid="uid"+1e9*Math.random());var r=localStorage.gaNoCookieUid,o="http://www.google-analytics.com/collect?payload_data&v=1&aip=1&z="+n+"&tid="+e+"&cid="+r+"&t="+t+"&"+a,i=document.createElement("img");i.setAttribute("src",o),i.style.position="absolute",i.style.height="0px",document.body.appendChild(i),setTimeout(function(){$(i).remove()},1e3)},gaNoCookieSendPageView=function(e,t,a){var t=encodeURIComponent(t),a=encodeURIComponent(a),n="dp="+t+"&dt="+a+"&";gaNoCookieSendHit(e,"pageview",n)},gaNoCookieSendEvent=function(e,t,a,n){"undefined"==typeof n&&(n=""),t=encodeURIComponent(t),a=encodeURIComponent(a),n=encodeURIComponent(n);var r="ec="+t+"&ea="+a+"&el="+n+"&";gaNoCookieSendHit(e,"event",r)},gaSendPageView=function(e){var t=isApp()?"/PinegrowApp/":"/PinegrowWeb/";isApp()?(t+=crsaIsBig()?"Pro/":"Demo/",e&&(t+=e+"/"),t+=crsaGetVersion(),gaNoCookieSendPageView("UA-344271-72",t,"Pinegrow App Run")):(e&&(t+=e+"/"),t+=crsaGetVersion(),ga("send","pageview",t))},crsaIsInEdit=function(){return $.fn.crsa("getEditor").isInEdit()},crsaEndEditModeIfActive=function(){return crsaIsInEdit()?($.fn.crsa("getEditor").endEdit(),!0):!1},crsaWillChangeDom=function(){return crsaEndEditModeIfActive()},crsaAddKbd=function(e,t){var a=t.indexOf("SHIFT")>=0,n=t.indexOf("CMD")>=0,r=t.indexOf("ALT")>=0,o="";a&&(o+="&#8679;",t=t.replace("SHIFT","")),r&&(o+="&#8997;",t=t.replace("ALT","")),n&&(o+="&#8984;",t=t.replace("CMD","")),o+=$.trim(t),e.append('<span class="kbdspacer"></span><span class="kbd">'+o+"</span>"),e.parent().addClass("haskbd")},PgCustomLogic=function(){this.nodeFilter=null,this.getTreeRootForElement=null,this.navBar=null,this.defaultZoom="fit",this.showOnlyClassesInProperties=!1,this.openTab="lib",this.textPropsElementNotSelected="Click on any element in the page to show its properties.",this.onPageLoaded=null,this.onPageChanged=null,this.scrollMode=!0,this.warnOnUnloadPage=!0},CrsaProfile=function(){var e,t=!1;t&&(e=(new Date).getTime()),this.show=function(a){if(t){var n=(new Date).getTime()-e;console.log(a+" took "+n+" ms")}}},CrsaHttpServer=function(){var e={directory:"",port:4e4},t={http:require("http"),url:require("url"),fs:require("fs"),path:require("path")};this.url="http://localhost:"+e.port,this.makeUrl=function(e){return e.replace("file://",this.url+"/")},this.getOriginalUrl=function(e){return 0==e.indexOf(this.url+"/")&&(e=e.replace(this.url+"/","file://")),e};var a=function(e){var t=e.lastIndexOf("."),a=-1===t?"default":e.substr(t),n={".bmp":"image/bmp",".css":"text/css",".gif":"image/gif",".htm":"text/html",".html":"text/html",".jpg":"image/jpeg",".jpeg":"image/jpeg",".js":"application/javascript",".json":"application/json",".otf":"font/opentype",".png":"image/png",".text":"text/plain","default":null};return n[a.toLowerCase()]||n["default"]};try{var n=t.http.createServer(function(n,r){{var o=t.url.parse(n.url,!0),i=decodeURIComponent(o.pathname);n.method+" "+i.bold}"/"===i&&(i+="index.html");var l=t.path.join(e.directory,i);t.fs.exists(l,function(e){e?t.fs.readFile(l,function(e,t){if(!e){var n=a(l);if(n){if(["image/gif","image/jpeg","image/png"].indexOf(n)>=0?r.writeHead(200,{"content-type":n,"Cache-Control":"max-age=6000, public"}):r.writeHead(200,{"content-type":n,"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}),"text/html"==n&&pinegrow.sourceParser){var i=new pgParser;i.parse(t.toString("utf8")),t=new Buffer(i.rootNode.toString(null,!0,!0));var s={rootNode:i.rootNode,data:t,url:"file:/"+o.pathname};$("body").trigger("crsa-server-page-loaded",s)}r.write(t),r.end()}else r.writeHead(403,{}),r.write("<h1>403 - Type not allowed</h1>"),r.end()}}):(r.writeHead(404,{}),r.write("<h1>404 - Not Found</h1>"),r.end())})});n.on("error",function(){console.log("Could not start internal http server.")}),n.listen(e.port)}catch(r){}};